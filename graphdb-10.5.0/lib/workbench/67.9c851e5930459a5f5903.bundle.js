(window.webpackJsonp=window.webpackJsonp||[]).push([[67,163],{139:function(e,t,r){"use strict";r.r(t);r(7),r(22),r(26),r(57),r(25);var n=r(0);function a(e,t,r,n,a,i,s){e.pluginName="sparql-template",e.setPluginIsActive=function(t){e.pluginIsActive=t},e.getSparqlTemplates=function(){i.isLicenseValid()&&t.getActiveRepository()&&!t.isActiveRepoOntopType()&&!t.isActiveRepoFedXType()?r.getSparqlTemplates(t.getActiveRepository()).success((function(t){e.sparqlTemplateIds=t})).error((function(e){const t=getError(e);n.error(t,s.instant("sparql.template.get.templates.error"))})):e.sparqlTemplateIds=[]},e.$watch((function(){return t.getActiveRepository()}),(function(){e.getSparqlTemplates()})),e.deleteTemplate=function(i){a.openSimpleModal({title:s.instant("common.warning"),message:s.instant("sparql.template.delete.template.warning",{templateID:i}),warning:!0}).result.then((function(){r.deleteSparqlTemplate(i,t.getActiveRepository()).success((function(){n.success(i,s.instant("sparql.template.delete.template.success")),e.getSparqlTemplates()})).error((function(e){n.error(getError(e),s.instant("sparql.template.delete.template.failure",{templateID:i}))}))}))}}function i(e,t,r,a,i,s,o,c,u,l,p,m){const d=t.hash()||"";e.templateID=(t.search().templateID||"")+(d?"#"+d:""),e.title=(e.templateID?m.instant("edit"):m.instant("common.create.btn"))+" SPARQL Template",e.getNamespaces=function(){v(!0,m.instant("common.refreshing.namespaces"),m.instant("common.extra.message")),c.getRepositoryNamespaces().success((function(t){const r={};t.results.bindings.forEach((function(e){r[e.prefix.value]=e.namespace.value})),e.namespaces=r})).error((function(t){e.repositoryError=getError(t)})).finally((function(){v(!1),D()}))},e.setLoader=v,e.addKnownPrefixes=b,e.noPadding={paddingRight:0,paddingLeft:0},e.currentTabConfig={},e.orientationViewMode=!0,e.currentQuery={};let f=!1;e.$watch((function(){return a.getActiveRepository()}),(function(e,r){e!==r&&t.path("/sparql-templates")}));let g=null;e.goBack=function(){g=s((function(){i.history.back()}),1e3)};const y=e.$on("$locationChangeStart",(function(t){!function(t){e.currentQuery.isPristine||(confirm(m.instant("jdbc.warning.unsaved.changes"))?(window.removeEventListener("beforeunload",w),y(),s.cancel(g)):t.preventDefault())}(t)}));function w(t){e.currentQuery.isPristine||(t.returnValue=!0)}window.addEventListener("beforeunload",w),e.$on("$destroy",(function(e){window.removeEventListener("beforeunload",w),y(),s.cancel(g)}));const T={templateID:"",query:"PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nPREFIX ex: <http://example.com#>\nDELETE {\n  ?subject ex:myPredicate ?oldValue .\n} INSERT {\n  ?subject ex:myPredicate ?newValue .\n} WHERE {\n  ?id rdf:type ex:MyType .\n  ?subject ex:isRelatedTo ?id .\n}\n",inference:!0,sameAs:!0,isNewTemplate:!0,isPristine:!0};var q;function v(t,r,n){const a=angular.element(document.getElementById("yasr-inner"));e.queryIsRunning=t,t?(e.queryStartTime=Date.now(),e.countTimeouted=!1,e.progressMessage=r,e.extraMessage=n,a.addClass("hide")):(e.progressMessage="",e.extraMessage="",a.removeClass("hide")),null===e.$$phase&&e.$apply()}function D(){e.tabsData=[e.currentQuery];const t=e.currentQuery;e.currentQuery.query?window.editor.setValue(e.currentQuery.query):window.editor.setValue(" "),s((function(){e.currentTabConfig={},e.currentTabConfig.queryType=t.queryType,e.currentTabConfig.resultsCount=t.resultsCount,e.currentTabConfig.offset=t.offset,e.currentTabConfig.allResultsCount=t.allResultsCount,e.currentTabConfig.page=t.page,e.currentTabConfig.pageSize=t.pageSize,e.currentTabConfig.timeFinished=t.timeFinished,e.currentTabConfig.timeTook=t.timeTook,e.currentTabConfig.sizeDelta=t.sizeDelta,e.$apply()}),0),e.canWriteActiveRepo()||(window.editor.options.readOnly=!0)}function I(){e.tabsData=e.tabs=[T],e.currentQuery=_.cloneDeep(T),window.editor&&(e.setQuery(e.currentQuery.query),D()),e.$watch((function(){return e.currentQuery.query}),(function(t,r){t!==r&&e.setDirty()}))}function b(){u.addKnownPrefixes(JSON.stringify(window.editor.getValue())).success((function(e){angular.isDefined(window.editor)&&angular.isDefined(e)&&e!==window.editor.getValue()&&window.editor.setValue(e)})).error((function(e){const t=getError(e);return r.error(t,m.instant("common.add.known.prefixes.error")),!0}))}function Q(){o.createSparqlTemplate(e.currentQuery,a.getActiveRepository()).success((function(){e.currentQuery.isPristine=!0,e.currentQuery.isNewTemplate=!1,r.success(e.currentQuery.templateID,m.instant("save.sparql.template.success.msg")),e.goBack()})).error((function(t){const n=getError(t);r.error(n,m.instant("save.sparql.template.failure.msg",{templateID:e.currentQuery.templateID}))}))}e.saveTab=function(){},e.setQuery=function(e){window.editor.setValue(e||" ")},e.templateID?(q=e.templateID,o.getSparqlTemplate(q,a.getActiveRepository()).success((function(e){T.query=e,T.templateID=q,T.isNewTemplate=!q,I()})).error((function(t){const n=getError(t);r.error(n,m.instant("sparql.template.get.template.error",{templateID:e.currentQuery.templateID})),e.repositoryError=n}))):I(),e.saveTemplate=function(){(function(){if(!window.editor||"update"!==window.editor.getQueryMode())return r.error(m.instant("sparql.template.query.constraint"),m.instant("jdbc.invalid.query")),!1;return!0})()&&(e.currentQuery.templateID?(e.isInvalidTemplateId=!l.isValidIri(e.currentQuery.templateID,e.currentQuery.templateID.toString()),e.isInvalidTemplateId||(e.currentQuery.isNewTemplate?o.getSparqlTemplates(a.getActiveRepository()).success((function(t){f=t.find(t=>t===e.currentQuery.templateID)})).error((function(e){const t=getError(e);r.error(t,m.instant("sparql.template.get.templates.error"))})).then(()=>{if(f){const t=Object(n.decodeHTML)(m.instant("sparql.template.existing.template.error",{templateID:e.currentQuery.templateID}));p.openSimpleModal({title:m.instant("common.confirm.save"),message:t,warning:!0}).result.then((function(){Q()}))}else Q()}):e.currentQuery.isPristine?e.goBack():o.updateSparqlTemplate(e.currentQuery,a.getActiveRepository()).success((function(){e.currentQuery.isPristine=!0,e.currentQuery.isNewTemplate=!1,r.success(e.currentQuery.templateID,m.instant("update.sparql.template.success.msg")),e.goBack()})).error((function(t){const n=getError(t);r.error(n,m.instant("save.sparql.template.failure.msg",{templateID:e.currentQuery.templateID}))})))):r.error(m.instant("sparql.template.iri.constraint")))},$("textarea").on("paste",(function(){s((function(){b()}),0)})),e.setDirty=function(){e.currentQuery.isPristine=!1}}angular.module("graphdb.framework.sparql-template.controllers",["ui.bootstrap","graphdb.framework.core.services.repositories","graphdb.framework.rest.monitoring.service","toastr"],["graphdb.framework.utils.notifications"]).controller("SparqlTemplatesCtrl",a).controller("SparqlTemplateCreateCtrl",i),a.$inject=["$scope","$repositories","SparqlTemplatesRestService","toastr","ModalService","$licenseService","$translate"],i.$inject=["$scope","$location","toastr","$repositories","$window","$timeout","SparqlTemplatesRestService","RDF4JRepositoriesRestService","SparqlRestService","UriUtils","ModalService","$translate"]},57:function(e,t){function r(e,t){return{showToastMessageWithDelay:function(r){return new Promise(n=>{e.success(t.instant(r)),setTimeout(n,200)})}}}angular.module("graphdb.framework.utils.notifications",[]).factory("Notifications",r),r.$inject=["toastr","$translate"]}}]);