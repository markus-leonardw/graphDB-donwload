(window.webpackJsonp=window.webpackJsonp||[]).push([[92],{104:function(e,t,s){(function(e){const t="WAIT",s="NO_REPO",r="READY",n="IN_PROGRESS",o="ERROR",a={contextID:{type:"all",value:"all.graphs.label",uri:""}};function i(e){if(e<1e3)return e;const t=Math.floor(Math.log(e)/Math.log(1e3));let s=e/Math.pow(1e3,t);return s=s%1>1/Math.pow(1e3,t-1)?s.toFixed(2):s.toFixed(0),s+["K","M","G","T","P","H"][t-1]}function l(e,i,l,c,u,d,p,f,g,h,m){let R=null;e.status=l.getActiveRepository()?t:s;let C=a;const y=function(){h.resolveGraphs().success((function(t){e.graphsInRepo=t.results.bindings.length>1002?t.results.bindings.slice(0,1002):t.results.bindings,v(),e.isSystemRepository()?"READY"!==e.status&&x():(e.status="WAIT",x(!0))})).error((function(t){e.repositoryError=getError(t),c.error(getError(t),m.instant("graphexplore.error.getting.graph"))}))},v=function(){const t=g.get("dependencies-selectedGraph-"+l.getActiveRepository());null!==t&&e.graphsInRepo.some(e=>e.contextID.uri===t.contextID.uri)?C=t:g.set("dependencies-selectedGraph-"+l.getActiveRepository(),C)},w=function(s){d3.select("#dependencies-chord").html(""),e.status=t,d.getRelationshipsData(s,e.direction,C.contextID.uri).success((function(t){e.dependenciesData={matrix:t.right,nodes:t.left,hasLinks:_.sum(_.map(t.right,(function(e){return _.sum(e)})))>0,direction:e.direction},e.status=r})).error((function(t){e.status=r,c.error(getError(t),m.instant("graphexplore.error.dependencies.count"))}))},x=function(s){(e.status!==r||s)&&(e.status=t,d.getRelationshipsStatus(C.contextID.uri).success((function(t){if(e.status=t,e.status===n){if(null!==R)return;R=u(x,2e3)}e.status===r&&(null!==R&&(u.cancel(R),R=null),d.getRelationshipsClasses(e.direction,C.contextID.uri).success((function(t,s){e.allClasses.items=_.filter(t,b),e.allNotFilteredClasses=t,e.selectedClasses=void 0,angular.isUndefined(e.selectedClasses)&&(e.selectedClasses=t.slice(0,10)),w(e.selectedClasses),207===s&&c.warning(m.instant("graphexplore.update.diagram"),m.instant("graphexplore.repository.data.changed"))}))),0===e.status.indexOf("ERROR;")&&(e.status=o,c.error(m.instant("graphexplore.error.dependencies.calc",{error:e.status.substring("ERROR;".length)})))})).error((function(t){e.status=o,c.error(getError(t),m.instant("graphexplore.error.dependencies.count.status"))})))};e.allClasses={},e.allClasses.items=[],e.allNotFilteredClasses=[],e.direction="all";const S={};let E=0,D=0;function b(t){return-1!==t.name.toLowerCase().indexOf(e.classQuery.query.toLowerCase())}i.key="",S.get=function(t,s,r){return p.initLazyList(t,s,r,E,e.allClasses.items)},i.$watch((function(){return i.key}),(function(){E=0,_.each(e.allClasses.items,(function(e){i.key>e&&E++})),D++})),S.revision=function(){return D},e.datasource=S,e.adapterContainer={adapter:{remain:!0}},e.classQuery={},e.classQuery.query="",e.classFilterFunc=b,e.$watch("allClasses.items",(function(){e.allClasses.items.length>0&&u((function(){e.adapterContainer.adapter.reload()}),30)})),e.$watch("direction",(function(){!l.getActiveRepository()||e.isSystemRepository()||l.isActiveRepoFedXType()||y()})),e.$on("$destroy",(function(){u.cancel(R)})),e.isLoading=function(){return e.status===n||e.status===t},e.confirmCalculateDependencies=function(){f.openSimpleModal({title:m.instant("confirm.operation"),message:m.instant("graphexplore.calculating.relationships"),warning:!0}).result.then((function(){e.calculateDependencies()}))},e.calculateDependencies=function(){e.status=t,e.selectedClasses=void 0,d.calculateRelationships(C.contextID.uri).success((function(t){0===t.indexOf("ERROR;")?c.error(m.instant("graphexplore.error.dependencies.calc",{error:e.status.substring("ERROR;".length)})):x()})).error((function(e){c.error(m.instant("graphexplore.error.could.not.force.count",{error:getError(e)}))}))},e.addClass=function(t){e.selectedClasses.push(t),w(e.selectedClasses)},e.removeClass=function(t){_.remove(e.selectedClasses,(function(e){return e.name===t.name})),w(e.selectedClasses)},e.showClass=function(t){e.classToShow=t},e.isClassByNameShown=function(t){return void 0!==_.find(e.selectedClasses,{name:t})},e.addClassByName=function(t){e.selectedClasses.push(_.find(e.allClasses.items,{name:t})),w(e.selectedClasses)},e.removeClassByName=function(t){_.remove(e.selectedClasses,(function(e){return e.name===t})),w(e.selectedClasses)},e.removeAllClasses=function(){e.selectedClasses=[],w(e.selectedClasses)},e.isSystemRepository=function(){return"SYSTEM"===l.getActiveRepository()};const A=e.$on("repositoryIsSet",(function(){e.classQuery={},e.classQuery.query="",e.repositoryError=null,C=a,l.getActiveRepository()&&!l.isActiveRepoFedXType()?y():e.status=s}));window.addEventListener("beforeunload",(function e(){A(),window.removeEventListener("beforeunload",e)})),e.selectGraph=function(e){C=e,x(!0),g.set("dependencies-selectedGraph-"+l.getActiveRepository(),C)},e.getSelectedGraphValue=function(){return C.contextID.value},e.isAllGraphsSelected=function(){return"all.graphs.label"===e.getSelectedGraphValue()}}Object.defineProperty(e,"allGraphs",{get:()=>a}),angular.module("graphdb.framework.graphexplore.controllers.dependencies",["ui.scroll.jqlite","ui.scroll","toastr","ui.bootstrap","graphdb.framework.core.services.repositories","graphdb.framework.utils.localstorageadapter"]).controller("DependenciesChordCtrl",l).config(["$uibTooltipProvider",function(e){e.options({appendToBody:!0})}]).filter("humanize",(function(){return i})),l.$inject=["$scope","$rootScope","$repositories","toastr","$timeout","GraphDataRestService","UiScrollService","ModalService","LocalStorageAdapter","RDF4JRepositoriesRestService","$translate"]}).call(this,s(11))}}]);