(window.webpackJsonp=window.webpackJsonp||[]).push([[6,138],{67:function(e,t,o){"use strict";o.r(t),o.d(t,"STATIC_RULESETS",(function(){return i})),o.d(t,"REPOSITORY_TYPES",(function(){return n})),o.d(t,"FILENAME_PATTERN",(function(){return r})),o.d(t,"NUMBER_PATTERN",(function(){return a}));const i=[{id:"empty",name:"No inference"},{id:"rdfs-optimized",name:"RDFS (Optimized)"},{id:"rdfs",name:"RDFS"},{id:"rdfsplus-optimized",name:"RDFS-Plus (Optimized)"},{id:"owl-horst-optimized",name:"OWL-Horst (Optimized)"},{id:"owl-horst",name:"OWL-Horst"},{id:"owl2-ql-optimized",name:"OWL2-QL (Optimized)"},{id:"owl2-ql",name:"OWL2-QL"},{id:"owl-max-optimized",name:"OWL-Max (Optimized)"},{id:"owl-max",name:"OWL-Max"},{id:"owl2-rl-optimized",name:"OWL2-RL (Optimized)"},{id:"owl2-rl",name:"OWL2-RL"}],n={graphdbRepo:"graphdb",free:"free",eeWorker:"worker",eeMaster:"master",ontop:"ontop",se:"se",fedx:"fedx"},r=new RegExp("^[a-zA-Z0-9-_]+$"),a=new RegExp("^[0-9]+$")},75:function(e,t,o){"use strict";o.r(t),o.d(t,"getFileName",(function(){return r}));var i=o(67),n=o(0);const r=function(e){let t=e.lastIndexOf("/");-1===t&&(t=e.lastIndexOf("\\"));let o=e;return-1!==t&&(o=o.substring(t+1)),o},a=function(e){e&&(e.queryTimeout&&(e.queryTimeout.value=parseInt(e.queryTimeout.value)),e.queryLimitResults&&e.validationResultsLimitTotal&&e.validationResultsLimitPerConstraint?(e.queryLimitResults.value=parseInt(e.queryLimitResults.value),e.validationResultsLimitTotal.value=parseInt(e.validationResultsLimitTotal.value),e.validationResultsLimitPerConstraint.value=parseInt(e.validationResultsLimitPerConstraint.value)):e.leftJoinWorkerThreads&&e.boundJoinBlockSize&&e.joinWorkerThreads&&e.unionWorkerThreads&&(e.leftJoinWorkerThreads.value=parseInt(e.leftJoinWorkerThreads.value),e.boundJoinBlockSize.value=parseInt(e.boundJoinBlockSize.value),e.joinWorkerThreads.value=parseInt(e.joinWorkerThreads.value),e.unionWorkerThreads.value=parseInt(e.unionWorkerThreads.value)))},s=function(){const e=document.getElementById("shaclOptions");if(e){const t=e.getAttribute("aria-expanded");if(t&&"true"===t)return"fa fa-angle-down"}return"fa fa-angle-right"},l=function(e,t){e.queryTimeout&&(t.isInvalidQueryTimeout=!i.NUMBER_PATTERN.test(e.queryTimeout.value)),e.validationResultsLimitTotal&&e.validationResultsLimitPerConstraint&&e.queryLimitResults?(t.isInvalidValidationResultsLimitTotal=!i.NUMBER_PATTERN.test(e.validationResultsLimitTotal.value),t.isInvalidValidationResultsLimitPerConstraint=!i.NUMBER_PATTERN.test(e.validationResultsLimitPerConstraint.value),t.isInvalidQueryLimit=!i.NUMBER_PATTERN.test(e.queryLimitResults.value)):e.leftJoinWorkerThreads&&e.boundJoinBlockSize&&e.joinWorkerThreads&&e.unionWorkerThreads&&(t.isInvalidLeftJoinWorkerThreads=!i.NUMBER_PATTERN.test(e.leftJoinWorkerThreads.value),t.isInvalidBoundJoinBlockSize=!i.NUMBER_PATTERN.test(e.boundJoinBlockSize.value),t.isInvalidJoinWorkerThreads=!i.NUMBER_PATTERN.test(e.joinWorkerThreads.value),t.isInvalidUnionWorkerThreads=!i.NUMBER_PATTERN.test(e.unionWorkerThreads.value))},c=function(e,t){return"isInvalidQueryLimit"===e?t.instant("invalid.query.limit"):"isInvalidQueryTimeout"===e?t.instant("invalid.query.timeout"):"isInvalidValidationResultsLimitTotal"===e?t.instant("invalid.validation.results.limit.total"):"isInvalidValidationResultsLimitPerConstraint"===e?t.instant("invalid.validation.results.limit.per.constraint"):"isInvalidJoinWorkerThreads"===e?t.instant("invalid.join.worker.threads"):"isInvalidLeftJoinWorkerThreads"===e?t.instant("invalid.left.join.worker.threads"):"isInvalidUnionWorkerThreads"===e?t.instant("invalid.union.worker.threads"):"isInvalidBoundJoinBlockSize"===e?t.instant("invalid.bound.join.block.size"):void 0},d=function(e,t){const o=Object.keys(e),i=Object.values(e);for(let e=0;e<o.length;e++)if(i[e])return c(o[e],t);return""},u=function(e){return"https://graphdb.ontotext.com/documentation/"+e.productShortVersion},p=function(e){return e.getLocations().then(e=>e.filter(e=>!e.errorMsg&&!e.degradedReason))};function f(e,t,o,r,a,s,l,c,d,u,p,f,m){e.loader=!0,e.isLocationInactive=function(t){return!t.active||!e.hasActiveLocation()};const v=f.defer();function y(){return a.getLocations(v).then(t=>(e.locations=t,t)).finally(()=>e.loader=!1)}e.hasActiveLocation=function(){return a.hasActiveLocation()},e.getActiveLocation=function(){return a.getActiveLocation()},e.getLocationError=function(){return a.getLocationError()},e.getDegradedReason=function(){return a.getDegradedReason()},e.getRepositories=function(){return a.getRepositories()},e.isRepoActive=function(e){return a.isRepoActive(e)},e.deleteLocation=function(t){s.openSimpleModal({title:p.instant("location.confirm.detach"),message:p.instant("location.confirm.detach.warning",{uri:t}),warning:!0}).result.then((function(){e.loader=!0,a.deleteLocation(t).finally(()=>y())}))},e.addLocationHttp=function(t){e.loader=!0,c.addLocation(t).success((function(){a.init()})).error((function(e){const t=getError(e);r.error(t,p.instant("common.error"))})).finally(()=>y())},e.addLocation=function(){o.open({templateUrl:"js/angular/templates/modal/add-location.html",windowClass:"addLocationDialog",controller:"AddLocationCtrl"}).result.then((function(t){e.addLocationHttp(t)}))},e.editLocationHttp=function(t){e.loader=!0,c.editLocation(t).success((function(){a.init()})).error((function(e){const t=getError(e);r.error(t,p.instant("common.error"))})).finally(()=>y())},e.editLocation=function(t){o.open({templateUrl:"js/angular/templates/modal/edit-location.html",controller:"EditLocationCtrl",resolve:{location:function(){return t}}}).result.then((function(t){e.editLocationHttp(t)}),(function(){}))},e.setRepository=function(e){a.setRepository(e)},e.deleteRepository=function(t){s.openSimpleModal({title:p.instant("common.confirm.delete"),message:Object(n.decodeHTML)(p.instant("delete.repo.warning.msg",{repositoryId:t.id})),warning:!0}).result.then((function(){e.loader=!0,a.deleteRepository(t).finally(()=>{y(),e.loader=!1}),function(e){const t="dependencies-selectedGraph-"+e.id,o="classHierarchy-selectedGraph-"+e.id;angular.forEach(d.keys(),(function(e){(e.startsWith(o)||e.startsWith(t))&&d.remove(e)}))}(t)}))},e.restartRepository=function(t){s.openSimpleModal({title:p.instant("confirm.restart.repo"),message:Object(n.decodeHTML)(p.instant("confirm.restart.repo.warning.msg",{repositoryId:t.id})),warning:!0}).result.then((function(){e.loader=!0,a.restartRepository(t).finally(()=>y())}))},e.toggleDefaultRepository=function(t){e.getDefaultRepository()===t?a.setDefaultRepository(null):a.setDefaultRepository(t)},e.getDefaultRepository=function(){return a.getDefaultRepository()},e.getRepositoryDownloadLink=function(e){let t=`rest/repositories/${e.id}${e.type===i.REPOSITORY_TYPES.ontop?"/download-zip":"/download-ttl"}?location=${e.location}`;const o=l.getAuthToken();return o&&(t=`${t}&authToken=${encodeURIComponent(o)}`),t},e.copyToClipboard=function(e){s.openCopyToClipboardModal(e)},e.fromFile=function(){o.open({templateUrl:"js/angular/templates/modal/upload-repository-config.html",controller:"UploadRepositoryConfigCtrl"}).result.then((function(){a.init()}))},e.openActiveLocationSettings=function(){o.open({templateUrl:"js/angular/settings/modal/location-settings.html",controller:"ActiveLocationSettingsCtrl"})},y();const R=u((function(){m.isActive()&&!t.guidePaused||(a.initQuick(),y())}),5e3);e.$on("$destroy",(function(){u.cancel(R),v&&v.resolve()})),e.getRepositoriesFromLocation=function(e){return a.getRepositoriesFromLocation(e)}}function m(e,t,o,i,n){e.upload=function(t){t&&t.length&&(e.uploadFile=t[0])},e.ok=function(){e.uploadFile&&(e.uploadFileLoader=!0,o.upload({url:"rest/repositories",method:"POST",data:{config:e.uploadFile}}).success((function(){e.uploadFileLoader=!1,t.close()})).error((function(t){const o=getError(t);i.error(o,n.instant("common.error")),e.uploadFileLoader=!1})))},e.cancel=function(){t.dismiss("cancel")}}function v(e,t,o,i,n){e.newLocation={uri:"",authType:"none",username:"",password:"",active:!1},e.docBase=u(i),e.isValidLocation=function(){return(e.newLocation.uri.length<6||0===e.newLocation.uri.indexOf("http:")||0===e.newLocation.uri.indexOf("https:"))&&e.newLocation.uri.indexOf("/repositories")<=-1},e.ok=function(){e.newLocation?t.close(e.newLocation):o.error(n.instant("location.cannot.be.empty.error"))},e.cancel=function(){t.dismiss("cancel")}}function y(e,t,o,i){e.editedLocation=_.cloneDeep(o),e.docBase=u(i),e.ok=function(){t.close(e.editedLocation)},e.cancel=function(){t.dismiss("cancel")}}function R(e,t){e.repositoryTypes=i.REPOSITORY_TYPES,e.chooseRepositoryType=function(e){t.path(`${t.path()}/${e}`)}}function T(e,t,o,n,r,c,u,f,m,v){function y(e){switch(e){case i.REPOSITORY_TYPES.graphdbRepo:t.pageTitle=v.instant("view.create.repo.title",{repoType:"GraphDB"});break;case i.REPOSITORY_TYPES.ontop:t.pageTitle=v.instant("view.create.repo.title",{repoType:"Ontop Virtual SPARQL"});break;case i.REPOSITORY_TYPES.fedx:t.pageTitle=v.instant("view.create.repo.title",{repoType:"FedX Virtual SPARQL"})}}var R;t.rulesets=i.STATIC_RULESETS.slice(),t.repositoryTypes=i.REPOSITORY_TYPES,t.params=f,t.repositoryType=f.repositoryType,t.enable=!0,t.loader=!0,t.pageTitle=v.instant("view.create.repo.title"),t.repositoryInfo={id:"",params:{},title:"",type:"",location:""},t.invalidValues={isInvalidQueryTimeout:!1,isInvalidQueryLimit:!1,isInvalidLeftJoinWorkerThreads:!1,isInvalidBoundJoinBlockSize:!1,isInvalidJoinWorkerThreads:!1,isInvalidUnionWorkerThreads:!1,isInvalidValidationResultsLimitPerConstraint:!1,isInvalidValidationResultsLimitTotal:!1},p(n).then(e=>{t.locations=e}),t.changedLocation=function(){t.$broadcast("changedLocation")},t.getConfig=function(e){m.getRepositoryConfiguration(e).then((function(e){const o=e.data;var i;t.repositoryInfo.params=o.params,t.repositoryInfo.type=o.type,a(t.repositoryInfo.params),(i=t.repositoryInfo.params)&&i.member&&(i.member.value=[]),t.loader=!1,c((function(){angular.element(document).find("#id").focus()}),50)})).catch((function(e){const i=getError(e);o.error(i,v.instant("common.error")),t.loader=!1}))},t.repositoryType&&(function(e){return t.isEnterprise()&&e===i.REPOSITORY_TYPES.graphdbRepo}(R=t.repositoryType)||function(e){return!t.isFreeEdition()&&!t.isEnterprise()&&e===i.REPOSITORY_TYPES.graphdbRepo}(R)||function(e){return t.isFreeEdition()&&e===i.REPOSITORY_TYPES.graphdbRepo}(R)||function(e){return e===i.REPOSITORY_TYPES.ontop}(R)||function(e){return e===i.REPOSITORY_TYPES.fedx}(R))?(t.repositoryInfo.type=t.repositoryType,t.getConfig(t.repositoryType),y(t.repositoryType)):r.path("/repository/create"),t.hasActiveLocation=function(){return n.hasActiveLocation()},t.activeLocation=function(){return n.getActiveLocation()};let T=!1;t.uploadRuleset=function(e){e&&e.length&&(t.uploadFile=e[0],t.uploadFileLoader=!0,u.upload({url:"rest/repositories/ruleset/upload",data:{ruleset:t.uploadFile,location:t.repositoryInfo.location}}).progress((function(e){})).success((function(e){if(e.success){const o=t.uploadFile.name,i={id:e.fileLocation,name:"Custom: "+o};t.rulesetPie?t.rulesets[0]=i:t.rulesets.unshift(i),t.rulesetPie=e.fileLocation,t.rulesetPieFile=o,t.repositoryInfo.params.ruleset.value=t.rulesetPie}else o.error(e.errorMessage),T=!0;t.uploadFileLoader=!1})).error((function(e){const i=getError(e);o.error(i,v.instant("common.error")),t.uploadFile="",t.uploadFileLoader=!1})))},t.noMembersError=function(){o.error(v.instant("fedx.create.repo.no.members.warning"))},t.goBackToPreviousLocation=function(){angular.isDefined(f.previous)?(delete r.$$search.previous,r.path("/")):r.path("/repository")},t.createRepoHttp=function(){t.loader=!0,m.createRepository(t.repositoryInfo).then((function(){return o.success(v.instant("created.repo.success.msg",{repoId:t.repositoryInfo.id})),n.init()})).then(()=>t.goBackToPreviousLocation()).catch((function(e){const t=getError(e.data);o.error(t,v.instant("common.error"))})).finally(()=>{t.loader=!1})},t.createRepo=function(){if(!t.repositoryInfo.id)return void o.error(v.instant("empty.repoid.warning"));t.isInvalidRepoName=!i.FILENAME_PATTERN.test(t.repositoryInfo.id),l(t.repositoryInfo.params,t.invalidValues);const e=d(t.invalidValues,v);T?o.error(v.instant("invalid.ruleset.file.error")):t.isInvalidRepoName?o.error(v.instant("wrong.repo.name.error")):"fedx"===t.repositoryType&&0===t.repositoryInfo.params.member.value.length?t.noMembersError():e?o.error(e):t.createRepoHttp()},t.rulesetWarning=function(){const e=t.repositoryInfo.params;return void 0===e||void 0===e.ruleset||void 0===e.disableSameAs?"":0===e.ruleset.value.indexOf("owl")&&"true"===e.disableSameAs.value?v.instant("repoTooltips.rulesetWarnings.needsSameAs"):0===e.ruleset.value.indexOf("rdfs")&&"false"===e.disableSameAs.value?v.instant("repoTooltips.rulesetWarnings.doesntNeedSameAs"):e.ruleset.value===t.rulesetPie?v.instant("repoTooltips.rulesetWarnings.customRuleset"):""},t.validateNumberInput=function(){l(t.repositoryInfo.params,t.invalidValues)},t.getShaclOptionsClass=function(){return s()},t.autofocusId="autofocus";const g=e.$on("$translateChangeSuccess",()=>{y(t.repositoryType)});t.$on("$destroy",()=>{g()})}function g(e,t,o,i,n,r,a){e.dialogTitle=a||r.instant("update.file.content.header"),i&&o.getRepositoryFileContent(i).success((function(t){e.fileContent=t})).error((function(e){const t=getError(e);n.error(t,r.instant("common.error"))})),e.ok=function(){t.close({content:e.fileContent,fileLocation:i})},e.cancel=function(){t.dismiss("cancel")}}function I(e,t,o,c,u,f,m,v,y,R){t.rulesets=i.STATIC_RULESETS.slice(),t.repositoryTypes=i.REPOSITORY_TYPES,t.editRepoPage=!0,t.canEditRepoId=!1,t.isRepoInCluster=!0,t.params=o,t.loader=!0,t.repositoryInfo={},t.repositoryInfo.id=t.params.repositoryId,t.repositoryInfo.location=t.params.location,t.repositoryInfo.restartRequested=!1,t.repositoryType="",t.saveRepoId=t.params.repositoryId,t.pageTitle=y.instant("view.edit.repo.title",{repositoryId:t.params.repositoryId}),t.invalidValues={isInvalidQueryTimeout:!1,isInvalidQueryLimit:!1,isInvalidLeftJoinWorkerThreads:!1,isInvalidBoundJoinBlockSize:!1,isInvalidJoinWorkerThreads:!1,isInvalidUnionWorkerThreads:!1,isInvalidValidationResultsLimitPerConstraint:!1,isInvalidValidationResultsLimitTotal:!1},t.hasActiveLocation=function(){return u.hasActiveLocation()};t.$watch(t.hasActiveLocation,(function(){t.hasActiveLocation&&Promise.all([p(u).then(e=>(t.locations=e,v.getRepository(t.repositoryInfo))),R.monitorActiveOperations(t.repositoryInfo.id)]).then(([e,o])=>{t.isRepoInCluster=o.hasClusterOperation();const i=e.data;if(angular.isDefined(i.params.ruleset)){let e=!1;if(angular.forEach(t.rulesets,(function(t){t.id===i.params.ruleset.value&&(e=!0)})),i.params.ruleset&&!e){const e=r(i.params.ruleset.value);t.rulesets.unshift({id:i.params.ruleset.value,name:"Custom: "+e})}}t.repositoryInfo=i,t.setRepositoryType(i.type),a(t.repositoryInfo.params),t.repositoryInfo.saveId=t.saveRepoId,t.loader=!1}).catch((function(e){const i=e.data,r=e.status,a=o.repositoryId;let s;s=404===r&&"system"!==a?Object(n.decodeHTML)(y.instant("edit.repo.error.not.exists",{repositoryId:a})):404===r&&"system"===a?Object(n.decodeHTML)(y.instant("edit.system.repo.warning")):getError(i),c.error(s,y.instant("common.error"),{allowHtml:!0}),404===r?setTimeout((function(){t.loader=!1,f.path("repository")}),1e3):t.loader=!1}))})),t.setRepositoryType=function(e){t.repositoryType=e},t.noMembersError=function(){c.error(y.instant("fedx.create.repo.no.members.warning"))},t.editRepoHttp=function(){t.loader=!0,v.editRepository(t.repositoryInfo.saveId,t.repositoryInfo).success((function(){c.success(y.instant("edit.repo.success.msg",{saveId:t.repositoryInfo.saveId})),u.init().finally(()=>t.goBackToPreviousLocation()),t.repositoryInfo.saveId===t.repositoryInfo.id&&t.repositoryInfo.restartRequested&&u.restartRepository(t.repositoryInfo)})).error((function(e){const o=getError(e);c.error(o,y.instant("common.error")),t.loader=!1}))},t.editRepository=function(){t.isInvalidRepoName=!i.FILENAME_PATTERN.test(t.repositoryInfo.id),l(t.repositoryInfo.params,t.invalidValues);const e=d(t.invalidValues,y);let o=Object(n.decodeHTML)(y.instant("edit.repo.save.changes.msg",{repoId:t.repositoryInfo.id}));t.repositoryInfo.saveId!==t.repositoryInfo.id?o+=Object(n.decodeHTML)(y.instant("edit.repo.rename.changes.msg")):t.repositoryInfo.restartRequested?o+=Object(n.decodeHTML)(y.instant("edit.repo.restart.requested.msg")):o+=Object(n.decodeHTML)(y.instant("edit.repo.restart.needed.msg")),t.isInvalidRepoName?c.error(y.instant("wrong.repo.name.error")):"fedx"===t.repositoryType&&0===t.repositoryInfo.params.member.value.length?t.noMembersError():e?c.error(e):m.openSimpleModal({title:y.instant("common.confirm.save"),message:o,warning:!0}).result.then((function(){t.editRepoHttp()}))},t.editRepositoryId=function(){if(t.isRepoInCluster)return;let e=Object(n.decodeHTML)(y.instant("edit.repo.id.warning.msg"));t.isEnterprise()&&(e+=Object(n.decodeHTML)(y.instant("edit.repo.id.cluster.warning.msg"))),m.openSimpleModal({title:y.instant("confirm.enable.edit"),message:e,warning:!0}).result.then((function(){t.canEditRepoId=!0}))},t.goBackToPreviousLocation=function(){angular.isDefined(o.previous)?(delete f.$$search.previous,f.path("/")):f.path("/repository")},t.validateNumberInput=function(){l(t.repositoryInfo.params,t.invalidValues)},t.getShaclOptionsClass=function(){return s()};const T=e.$on("$translateChangeSuccess",()=>{t.pageTitle=y.instant("view.edit.repo.title",{repositoryId:t.params.repositoryId})});t.$on("$destroy",()=>{T()})}angular.module("graphdb.framework.repositories.controllers",["ngCookies","ui.bootstrap","graphdb.framework.core.services.repositories","graphdb.framework.utils.localstorageadapter","toastr","ngFileUpload"]).controller("LocationsAndRepositoriesCtrl",f).controller("AddLocationCtrl",v).controller("EditLocationCtrl",y).controller("ChooseRepositoryCtrl",R).controller("AddRepositoryCtrl",T).controller("EditRepositoryCtrl",I).controller("EditRepositoryFileCtrl",g).controller("UploadRepositoryConfigCtrl",m),f.$inject=["$scope","$rootScope","$uibModal","toastr","$repositories","ModalService","AuthTokenService","LocationsRestService","LocalStorageAdapter","$interval","$translate","$q","GuidesService"],m.$inject=["$scope","$uibModalInstance","Upload","toastr","$translate"],v.$inject=["$scope","$uibModalInstance","toastr","productInfo","$translate"],y.$inject=["$scope","$uibModalInstance","location","productInfo"],R.$inject=["$scope","$location"],T.$inject=["$rootScope","$scope","toastr","$repositories","$location","$timeout","Upload","$routeParams","RepositoriesRestService","$translate"],g.$inject=["$scope","$uibModalInstance","RepositoriesRestService","file","toastr","$translate","dialogTitle"],I.$inject=["$rootScope","$scope","$routeParams","toastr","$repositories","$location","ModalService","RepositoriesRestService","$translate","MonitoringRestService"]}}]);