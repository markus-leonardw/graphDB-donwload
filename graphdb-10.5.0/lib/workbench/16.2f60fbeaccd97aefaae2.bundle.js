(window.webpackJsonp=window.webpackJsonp||[]).push([[16,11,38,67,83,84,151,163],{136:function(e,t){angular.module("graphdb.framework.rest.sparql-templates.service",[]).factory("SparqlTemplatesRestService",r),r.$inject=["$http"];function r(e){return{getSparqlTemplates:function(t){return e.get(`rest/repositories/${t}/sparql-templates`)},getSparqlTemplate:function(t,r){return e.get(`rest/repositories/${r}/sparql-templates/configuration`,{params:{templateID:t}})},createSparqlTemplate:function(t,r){return e.post(`rest/repositories/${r}/sparql-templates`,{templateID:t.templateID,query:t.query})},updateSparqlTemplate:function(t,r){return e.put(`rest/repositories/${r}/sparql-templates`,t.query,{params:{templateID:t.templateID},headers:{"Content-Type":"text/plain"}})},deleteSparqlTemplate:function(t,r){return e.delete(`rest/repositories/${r}/sparql-templates`,{params:{templateID:t}})}}}},139:function(e,t,r){"use strict";r.r(t);r(7),r(22),r(26),r(57),r(25);var n=r(0);function a(e,t,r,n,a,i,o){e.pluginName="sparql-template",e.setPluginIsActive=function(t){e.pluginIsActive=t},e.getSparqlTemplates=function(){i.isLicenseValid()&&t.getActiveRepository()&&!t.isActiveRepoOntopType()&&!t.isActiveRepoFedXType()?r.getSparqlTemplates(t.getActiveRepository()).success((function(t){e.sparqlTemplateIds=t})).error((function(e){const t=getError(e);n.error(t,o.instant("sparql.template.get.templates.error"))})):e.sparqlTemplateIds=[]},e.$watch((function(){return t.getActiveRepository()}),(function(){e.getSparqlTemplates()})),e.deleteTemplate=function(i){a.openSimpleModal({title:o.instant("common.warning"),message:o.instant("sparql.template.delete.template.warning",{templateID:i}),warning:!0}).result.then((function(){r.deleteSparqlTemplate(i,t.getActiveRepository()).success((function(){n.success(i,o.instant("sparql.template.delete.template.success")),e.getSparqlTemplates()})).error((function(e){n.error(getError(e),o.instant("sparql.template.delete.template.failure",{templateID:i}))}))}))}}function i(e,t,r,a,i,o,s,u,c,l,d,p){const g=t.hash()||"";e.templateID=(t.search().templateID||"")+(g?"#"+g:""),e.title=(e.templateID?p.instant("edit"):p.instant("common.create.btn"))+" SPARQL Template",e.getNamespaces=function(){h(!0,p.instant("common.refreshing.namespaces"),p.instant("common.extra.message")),u.getRepositoryNamespaces().success((function(t){const r={};t.results.bindings.forEach((function(e){r[e.prefix.value]=e.namespace.value})),e.namespaces=r})).error((function(t){e.repositoryError=getError(t)})).finally((function(){h(!1),q()}))},e.setLoader=h,e.addKnownPrefixes=S,e.noPadding={paddingRight:0,paddingLeft:0},e.currentTabConfig={},e.orientationViewMode=!0,e.currentQuery={};let f=!1;e.$watch((function(){return a.getActiveRepository()}),(function(e,r){e!==r&&t.path("/sparql-templates")}));let m=null;e.goBack=function(){m=o((function(){i.history.back()}),1e3)};const y=e.$on("$locationChangeStart",(function(t){!function(t){e.currentQuery.isPristine||(confirm(p.instant("jdbc.warning.unsaved.changes"))?(window.removeEventListener("beforeunload",b),y(),o.cancel(m)):t.preventDefault())}(t)}));function b(t){e.currentQuery.isPristine||(t.returnValue=!0)}window.addEventListener("beforeunload",b),e.$on("$destroy",(function(e){window.removeEventListener("beforeunload",b),y(),o.cancel(m)}));const w={templateID:"",query:"PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>\nPREFIX ex: <http://example.com#>\nDELETE {\n  ?subject ex:myPredicate ?oldValue .\n} INSERT {\n  ?subject ex:myPredicate ?newValue .\n} WHERE {\n  ?id rdf:type ex:MyType .\n  ?subject ex:isRelatedTo ?id .\n}\n",inference:!0,sameAs:!0,isNewTemplate:!0,isPristine:!0};var T;function h(t,r,n){const a=angular.element(document.getElementById("yasr-inner"));e.queryIsRunning=t,t?(e.queryStartTime=Date.now(),e.countTimeouted=!1,e.progressMessage=r,e.extraMessage=n,a.addClass("hide")):(e.progressMessage="",e.extraMessage="",a.removeClass("hide")),null===e.$$phase&&e.$apply()}function q(){e.tabsData=[e.currentQuery];const t=e.currentQuery;e.currentQuery.query?window.editor.setValue(e.currentQuery.query):window.editor.setValue(" "),o((function(){e.currentTabConfig={},e.currentTabConfig.queryType=t.queryType,e.currentTabConfig.resultsCount=t.resultsCount,e.currentTabConfig.offset=t.offset,e.currentTabConfig.allResultsCount=t.allResultsCount,e.currentTabConfig.page=t.page,e.currentTabConfig.pageSize=t.pageSize,e.currentTabConfig.timeFinished=t.timeFinished,e.currentTabConfig.timeTook=t.timeTook,e.currentTabConfig.sizeDelta=t.sizeDelta,e.$apply()}),0),e.canWriteActiveRepo()||(window.editor.options.readOnly=!0)}function v(){e.tabsData=e.tabs=[w],e.currentQuery=_.cloneDeep(w),window.editor&&(e.setQuery(e.currentQuery.query),q()),e.$watch((function(){return e.currentQuery.query}),(function(t,r){t!==r&&e.setDirty()}))}function S(){c.addKnownPrefixes(JSON.stringify(window.editor.getValue())).success((function(e){angular.isDefined(window.editor)&&angular.isDefined(e)&&e!==window.editor.getValue()&&window.editor.setValue(e)})).error((function(e){const t=getError(e);return r.error(t,p.instant("common.add.known.prefixes.error")),!0}))}function C(){s.createSparqlTemplate(e.currentQuery,a.getActiveRepository()).success((function(){e.currentQuery.isPristine=!0,e.currentQuery.isNewTemplate=!1,r.success(e.currentQuery.templateID,p.instant("save.sparql.template.success.msg")),e.goBack()})).error((function(t){const n=getError(t);r.error(n,p.instant("save.sparql.template.failure.msg",{templateID:e.currentQuery.templateID}))}))}e.saveTab=function(){},e.setQuery=function(e){window.editor.setValue(e||" ")},e.templateID?(T=e.templateID,s.getSparqlTemplate(T,a.getActiveRepository()).success((function(e){w.query=e,w.templateID=T,w.isNewTemplate=!T,v()})).error((function(t){const n=getError(t);r.error(n,p.instant("sparql.template.get.template.error",{templateID:e.currentQuery.templateID})),e.repositoryError=n}))):v(),e.saveTemplate=function(){(function(){if(!window.editor||"update"!==window.editor.getQueryMode())return r.error(p.instant("sparql.template.query.constraint"),p.instant("jdbc.invalid.query")),!1;return!0})()&&(e.currentQuery.templateID?(e.isInvalidTemplateId=!l.isValidIri(e.currentQuery.templateID,e.currentQuery.templateID.toString()),e.isInvalidTemplateId||(e.currentQuery.isNewTemplate?s.getSparqlTemplates(a.getActiveRepository()).success((function(t){f=t.find(t=>t===e.currentQuery.templateID)})).error((function(e){const t=getError(e);r.error(t,p.instant("sparql.template.get.templates.error"))})).then(()=>{if(f){const t=Object(n.decodeHTML)(p.instant("sparql.template.existing.template.error",{templateID:e.currentQuery.templateID}));d.openSimpleModal({title:p.instant("common.confirm.save"),message:t,warning:!0}).result.then((function(){C()}))}else C()}):e.currentQuery.isPristine?e.goBack():s.updateSparqlTemplate(e.currentQuery,a.getActiveRepository()).success((function(){e.currentQuery.isPristine=!0,e.currentQuery.isNewTemplate=!1,r.success(e.currentQuery.templateID,p.instant("update.sparql.template.success.msg")),e.goBack()})).error((function(t){const n=getError(t);r.error(n,p.instant("save.sparql.template.failure.msg",{templateID:e.currentQuery.templateID}))})))):r.error(p.instant("sparql.template.iri.constraint")))},$("textarea").on("paste",(function(){o((function(){S()}),0)})),e.setDirty=function(){e.currentQuery.isPristine=!1}}angular.module("graphdb.framework.sparql-template.controllers",["ui.bootstrap","graphdb.framework.core.services.repositories","graphdb.framework.rest.monitoring.service","toastr"],["graphdb.framework.utils.notifications"]).controller("SparqlTemplatesCtrl",a).controller("SparqlTemplateCreateCtrl",i),a.$inject=["$scope","$repositories","SparqlTemplatesRestService","toastr","ModalService","$licenseService","$translate"],i.$inject=["$scope","$location","toastr","$repositories","$window","$timeout","SparqlTemplatesRestService","RDF4JRepositoriesRestService","SparqlRestService","UriUtils","ModalService","$translate"]},209:function(e,t,r){"use strict";r.r(t);r(7),r(23),r(79),r(22),r(139),r(136),r(66),r(61),r(71),r(25);angular.module("graphdb.framework.sparql-template",["toastr","ui.bootstrap","graphdb.framework.sparql-template.controllers","graphdb.framework.core.services.repositories","graphdb.framework.core.directives","graphdb.framework.rest.sparql-templates.service","graphdb.framework.core.directives.queryeditor.controllers","graphdb.framework.core.directives.queryeditor.sparqltab","graphdb.framework.core.directives.queryeditor.queryeditor","graphdb.framework.utils.uriutils"])},314:function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},315:function(e,t){(function(t){e.exports=t}).call(this,{})},57:function(e,t){function r(e,t){return{showToastMessageWithDelay:function(r){return new Promise(n=>{e.success(t.instant(r)),setTimeout(n,200)})}}}angular.module("graphdb.framework.utils.notifications",[]).factory("Notifications",r),r.$inject=["toastr","$translate"]},61:function(e,t,r){"use strict";r.r(t);r(10),r(27);var n=r(0);function a(e,t,r,a,i,o,s,u,c,l,d,p,g,f,m){const y={id:"1",name:"",query:"select * where { \n\t?s ?p ?o .\n} limit 100 \n",inference:!0,sameAs:!0};let b,w;function T(t){!function(){if(a.isActiveRepoOntopType())return;const t=document.getElementById("sameAs");!t||e.currentQuery.inference||t.disabled?e.currentQuery.inference&&t.disabled&&(t.removeAttribute("disabled"),e.currentQuery.sameAs=b.appSettings.DEFAULT_SAMEAS):(t.disabled=!0,e.currentQuery.sameAs=!1)}(),e.tabs.forEach((function(r,n){r.id===t.id&&(e.tabs[n].query=t.query,a.isActiveRepoOntopType()||(e.tabs[n].inference=t.inference,e.tabs[n].sameAs=t.sameAs))})),g.set(f.TABS_STATE,e.tabs)}function h(t,r,n,a){const i=angular.element(document.getElementById("yasr-inner"));e.queryIsRunning=t,t?(e.queryStartTime=Date.now(),e.countTimeouted=!1,e.progressMessage=r,e.extraMessage=n,e.noLoaderTimer=a,i.addClass("hide")):(e.progressMessage="",e.extraMessage="",e.noLoaderTimer=!1,e.currentTrackAlias=null,e.abortRequested=!1,i.removeClass("hide")),null===e.$$phase&&e.$apply()}function q(r){function n(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0}if(e.orientationViewMode){if("yasr"===e.viewMode){let e=n()-document.querySelector(".CodeMirror-wrap").getBoundingClientRect().top;e-=40,document.querySelector(".CodeMirror-wrap").style.height=e+"px"}else e.noPadding={},document.querySelector(".CodeMirror-wrap").style.height="";document.getElementById("yasr").style.minHeight=""}else if(e.noPadding={paddingRight:15,paddingLeft:0},window.editor&&document.querySelector(".CodeMirror-wrap")){let e=n()-document.querySelector(".CodeMirror-wrap").getBoundingClientRect().top;e-=40,document.querySelector(".CodeMirror-wrap").style.height=e+"px",document.getElementById("yasr").style.minHeight=e+"px"}else{let n;n=t(r?function(){e.fixSizesOnHorizontalViewModeSwitch(r)}:e.fixSizesOnHorizontalViewModeSwitch,100),e.$on("$destroy",(function(){t.cancel(n)}))}window.yasr&&window.yasr.container&&t((function(){window.yasr.container.resize()}),100)}function v(){q(!0)}function S(t,r){r.newRepo&&(e.tabsData=g.get(f.TABS_STATE),e.tabsData.forEach((function(e){e.yasrData=void 0,e.queryType=void 0,e.resultsCount=0,e.allResultsCount=0,e.sizeDelta=void 0})),g.set(f.TABS_STATE,e.tabsData),e.tabs=e.tabsData,e.currentQuery={},e.errorMessage=null,e.repositoryError=null)}function C(e){t((function(){$('a[data-id = "'+e+'"]').tab("show")}),0)}function E(n,i){if(e.executedQueryTab=e.currentQuery,i){if("SELECT"!==window.editor.getQueryType()&&"CONSTRUCT"!==window.editor.getQueryType()&&"DESCRIBE"!==window.editor.getQueryType())return void r.warning(m.instant("query.editor.warning.msg"));if(a.isActiveRepoOntopType())return void r.warning(m.instant("query.editor.virtual.repo.warning.msg"))}if(e.explainRequested=i,!e.queryIsRunning){if(n?e.currentTabConfig.resultsCount=0:e.resetCurrentTabConfig(),e.lastRunQueryMode=window.editor.getQueryMode(),"update"===e.lastRunQueryMode&&a.isActiveRepoOntopType())return void r.warning(m.instant("query.editor.virtual.repo.update.warning.msg"));if(h(!0,"update"===e.lastRunQueryMode?m.instant("query.editor.executing.update"):m.instant("query.editor.evaluating.query")),"none"!==e.viewMode){e.viewMode="none",e.orientationViewMode&&e.fixSizesOnHorizontalViewModeSwitch();const r=t(window.editor.query,500);e.$on("$destroy",(function(){t.cancel(r)}))}else window.editor.query()}}function D(t){let r=void 0;return e.tabsData.forEach((function(e){if(e.name===t.name&&e.query===t.body)return r=e.id,e})),r}function Q(t){return function(r,n,a){e.savedQuery={name:r,query:n||window.editor.getValue(),shared:a},$(t).modal("show")}}function M(t){for(let r=0;r<e.tabsData.length;r++){if(e.tabsData[r].id===t)return r}}e.getPrincipal=function(){return l.getPrincipal().then(t=>{b=t,function(e,t){y.inference=t.appSettings.DEFAULT_INFERENCE,y.sameAs=t.appSettings.DEFAULT_SAMEAS,e.skipCountQuery=!t.appSettings.EXECUTE_COUNT,e.ignoreSharedQueries=t.appSettings.IGNORE_SHARED_QUERIES,e.tabsData=e.tabs=g.get(f.TABS_STATE)||[y],e.$watchCollection("[currentQuery.inference, currentQuery.sameAs]",(function(e,t,r){T(r.currentQuery)})),e.$on("repositoryIsSet",S)}(e,b)})},e.getPrincipal(),this.hint=document.createElement("span"),this.hint.innerHTML=m.instant("query.editor.autocomplete.hint"),this.hint.style.fontSize="12px",this.hint.style.color="gray",this.hint.style.backgroundColor="white",this.hint.style.position="absolute",this.hint.style.zIndex="3",this.hint.style.paddingLeft="12px",e.$watch((function(){return angular.element(".CodeMirror-hints").length}),e=>{if(e){const e=angular.element(".CodeMirror-hints")[0].getBoundingClientRect();document.body.appendChild(this.hint),this.hint.style.top=e.top-20+"px",this.hint.style.left=e.right-this.hint.offsetWidth-12+"px"}else this.hint&&this.hint.parentNode&&this.hint.parentNode.removeChild(this.hint)}),e.resetCurrentTabConfig=function(){e.currentTabConfig={pageSize:1e3,page:1,allResultsCount:0,resultsCount:0}},e.queryExists=!1,e.resetCurrentTabConfig(),e.saveTab=function(t){const r=M(t);if(void 0===r)return{};const n=e.tabsData[r];return e.saveQueryToLocal(n),n},e.loadTab=function(r){e.tabsData=g.get(f.TABS_STATE)||[y];const n=M(r),i=e.tabsData[n];i.yasrData&&h(!0,m.instant("query.editor.render.results.msg"),null,!0);t((function(){""===e.currentQuery.query&&(e.currentQuery.query=" "),t((function(){window.editor.setValue(e.currentQuery.query),e.yasr.updateDownloadDropdown(),e.$broadcast("tabLoaded",e.currentQuery.id),e.yasr.options.output=i.outputType,i.yasrData&&(i.yasrData.customError?(e.yasr.results={getException:function(){return i.yasrData.customError}},h(!1)):t((function(){e.setYasrResponse(i.yasrData,i.textStatus,i.jqXhrOrErrorString),h(!1),$(".yasr_btnGroup li:nth-child(2)").hasClass("active")&&t((function(){$(".yasr_btnGroup li:nth-child(2) a").get(0).click()}),0)}),0))}),0)}),0),g.set(f.TABS_STATE_CURRENT_ID,r),e.currentQuery=i,t((function(){e.currentTabConfig={},e.currentTabConfig.queryType=i.queryType,e.currentTabConfig.resultsCount=i.resultsCount,e.currentTabConfig.offset=i.offset,e.currentTabConfig.allResultsCount=i.allResultsCount,e.currentTabConfig.allResultsCountExact=i.allResultsCountExact,e.currentTabConfig.page=i.page,e.currentTabConfig.pageSize=i.pageSize,e.currentTabConfig.timeFinished=i.timeFinished,e.currentTabConfig.timeTook=i.timeTook,e.currentTabConfig.sizeDelta=i.sizeDelta,e.currentTabConfig.customUpdateMessage=i.customUpdateMessage,e.currentTabConfig.errorMessage=i.errorMessage,e.currentTabConfig.warningMessage=i.warningMessage,e.$apply()}),0),$("#yasr").css("padding","0"),w||(w=setInterval(x,200));!function(){const t=a.isActiveRepoOntopType(),r=a.isActiveRepoFedXType();(function(e){const t=document.getElementById("sameAs"),r=document.getElementById("inference");t&&(t.disabled=!!e);r&&(r.disabled=!!e)})(t),e.nocount=!(!t&&!r)||!b.appSettings.EXECUTE_COUNT,t&&(e.currentQuery.inference=!0,e.currentQuery.sameAs=!0)}()},e.addNewTab=function(r,n,a){if(!I(!0))return;let i;i=n||a?{id:"1",name:n,query:a,inference:b.appSettings.DEFAULT_INFERENCE,sameAs:b.appSettings.DEFAULT_SAMEAS}:{id:"1",name:"",query:"select * where { \n\t?s ?p ?o .\n} limit 100 \n",inference:b.appSettings.DEFAULT_INFERENCE,sameAs:b.appSettings.DEFAULT_SAMEAS};A++;const o=""+A;e.tabsData=e.tabs;const s=i;s.id=o,e.tabsData.push(s),g.set(f.TABS_STATE_MAXID,A),g.set(f.TABS_STATE,e.tabsData);const u=Array.prototype.slice.call(arguments,1);t((function(){e.$apply(),C(o),r&&r.apply(this,u)}),0),e.tabs=e.tabsData},e.isTabChangeOk=I,e.runQuery=E,e.abortCurrentQuery=function(){p.deleteQuery(e.currentTrackAlias,a.getActiveRepository()).success((function(){e.abortRequested=!0}))},e.editQuery=function(t){i.open({templateUrl:"js/angular/core/directives/queryeditor/templates/query-sample.html",controller:"QuerySampleModalCtrl",resolve:{data:function(){return{title:m.instant("query.editor.edit.saved.query",{name:t.name}),query:t,edit:!0,okButtonText:m.instant("common.save.btn")}}}}).result.then((function(n){const a={name:n.name,body:n.body,shared:n.shared};t.name!==n.name?s.addNewSavedQuery(a).success((function(){e.deleteQueryHttp(t.name,!0)})).error((function(e){const t=getError(e);r.error(t,m.instant("query.editor.edit.saved.query.error"))})):s.editSavedQuery(a).success((function(){$("#editQueryContainer").modal("hide"),e.toggleSampleQueries(),r.success(m.instant("query.editor.edit.saved.query.success.msg",{name:t.name}))})).error((function(e){const t=getError(e);r.error(t,m.instant("query.editor.edit.saved.query.error"))}))}))},e.getNamespaces=function(){h(!0,m.instant("common.refreshing.namespaces"),m.instant("common.extra.message")),e.namespacesLoading=!0,d.getRepositoryNamespaces().success((function(t){const r={};t.results.bindings.forEach((function(e){r[e.prefix.value]=e.namespace.value})),e.namespaces=r})).error((function(t){e.repositoryError=getError(t)})).finally((function(){h(!1),e.namespacesLoading=!1}))},e.changePagination=function(){E(!0,e.explainRequested)},e.toggleSampleQueries=function(){s.getSavedQueries().success((function(t){e.sampleQueries=t.filter(t=>!e.ignoreSharedQueries||t.owner!==e.principal.username)})).error((function(e){const t=getError(e);r.error(t,m.instant("query.editor.get.saved.queries.error"))}))},e.addKnownPrefixes=function(){s.addKnownPrefixes(JSON.stringify(window.editor.getValue())).success((function(e){angular.isDefined(window.editor)&&angular.isDefined(e)&&e!==window.editor.getValue()&&window.editor.setValue(e)})).error((function(e){const t=getError(e);return r.error(t,m.instant("common.add.known.prefixes.error")),!0}))},e.getExistingTabId=D,e.querySelected=function(t){const r=D(t);e.toggleSampleQueries(),e.isTabChangeOk(!1)&&(e.highlightNextTabChange=!0,angular.isDefined(r)?C(r):e.addNewTab(null,t.name,t.body))},e.deleteQuery=function(t){o.openSimpleModal({title:m.instant("common.confirm"),message:m.instant("query.editor.delete.saved.query.warning.msg",{savedQueryName:t}),warning:!0}).result.then((function(){e.deleteQueryHttp(t)}))},e.deleteQueryHttp=function(t,n){s.deleteSavedQuery(t).success((function(){e.toggleSampleQueries(),n||r.success(m.instant("query.editor.delete.saved.query.success.msg",{savedQueryName:t}))})).error((function(e){const t=getError(e);r.error(t,m.instant("query.editor.delete.saved.query.error"))}))},e.saveQuery=function(t,r){i.open({templateUrl:"js/angular/core/directives/queryeditor/templates/query-sample.html",controller:"QuerySampleModalCtrl",resolve:{data:function(){return{title:m.instant("query.editor.create.saved.query.msg"),query:{name:t.name,body:t.query,shared:t.shared},edit:!1,okButtonText:m.instant("common.create.btn"),queryExists:r,existingQueryErrMsg:Object(n.decodeHTML)(m.instant("query.sample.existing.query.warning",{name:t.name}))}}}}).result.then((function(t){e.saveQueryHttp(t)}),(function(){}))},e.saveQueryHttp=function(t){s.addNewSavedQuery(t).success((function(){r.success(m.instant("query.editor.save.saved.query.success.msg",{name:t.name}))})).error((function(n,a){const i=getError(n);r.error(i,m.instant("query.editor.create.saved.query.error"));let o=!1;409===a&&(o=!0),t.query=t.body,e.saveQuery(t,o)}))},e.saveQueryToLocal=T,e.setLoader=h,e.getLoaderMessage=function(){const t=(Date.now()-e.queryStartTime)/1e3;let r="",n="";e.noLoaderTimer||(r=e.getHumanReadableSeconds(t));n=e.progressMessage?m.instant("query.editor.progress.msg",{progressMessage:e.progressMessage,timeHuman:r}):m.instant("common.running.operation",{timeHuman:r});e.extraMessage&&t>10&&(n+=m.instant("query.editor.extra.msg",{extraMessage:e.extraMessage}));return n},e.fixSizesOnHorizontalViewModeSwitch=q,e.changeViewMode=function(){e.viewMode="none",e.orientationViewMode=!e.orientationViewMode,g.set(f.VIEW_MODE,e.orientationViewMode),q()},e.showHideEditor=v,e.focusQueryEditor=function(){angular.element(document).find(".editable-input").is(":focus")||angular.element(document).find(".CodeMirror textarea:first-child").focus()},e.orientationViewMode=!g.get(f.VIEW_MODE)||"true"===g.get(f.VIEW_MODE),e.viewMode="none",e.getActiveRepository=function(){return a.getActiveRepository()},e.getActiveRepositoryNoError=function(){if(!e.repositoryError)return a.getActiveRepository()},e.orientationViewMode||v(),window.onbeforeunload=function(){e.currentQuery&&e.saveTab(e.currentQuery.id),g.set(f.TABS_STATE,e.tabs)},e.$on("$destroy",(function(){e.currentQuery&&e.saveTab(e.currentQuery.id),g.set(f.TABS_STATE,e.tabs),clearInterval(w)})),e.$on("$destroy",(function(){clearInterval(w),window.editor=null,window.yasr=null}));let A=g.get(f.TABS_STATE_MAXID)||1;function R(e){return $(e).attr("data-id")}function x(){if(e.currentTabConfig.resultsCount>=0){const e=$(".saveAsDropDown");e.length>0&&!window.editor.queryValid?yasr.header.find(".saveAsDropDown").remove():0===e.length&&window.editor.queryValid&&yasr.updateDownloadDropdown()}}function I(t){return!(e.queryIsRunning&&!e.namespacesLoading)||(t?r.info(m.instant("query.editor.new.tab.running.query.warning.msg")):r.info(m.instant("query.editor.tab.switching.running.query.warning.msg")),!1)}e.highlightNextTabChange=!1,e.$on("tabAction",(function(r,n){n.relatedTarget&&(t.cancel(n.relatedTarget.timer),$(n.relatedTarget).css("color",""),e.saveTab(R(n.relatedTarget))),e.loadTab(R(n.target));const a=["var(--primary-color)","","var(--primary-color)"],i=[400,400,400];if(e.highlightNextTabChange){e.highlightNextTabChange=!1;let r=0;$(n.target).css("color",a[r]);const o=function(){r++,r<a.length?($(n.target).css("color",a[r]),n.target.timer=t(o,i[r])):$(n.target).css("color","")};t(o,i[r])}})),e.$on("deleteAllexeptSelected",(function(t,r){e.tabsData=r,e.tabs=r})),e.currentQuery={},e.savedQuery={},e.sampleQueries={},e.editQueryModal=Q("#editQueryContainer"),e.deleteQueryModal=Q("#confirmDeleteContainer"),e.saveQueryModal=Q("#saveQueryContainer"),e.getResultsDescription=function(){let t;if(0===e.currentTabConfig.resultsCount)t="No results.";else{const r=(e.currentTabConfig.page-1)*e.currentTabConfig.pageSize+Math.min(e.currentTabConfig.resultsCount,e.currentTabConfig.pageSize);t=m.instant("query.editor.showing.results.from.msg")+u("currency")(e.currentTabConfig.offset,"",0)+m.instant("query.editor.to")+u("currency")(r,"",0),e.currentTabConfig.allResultsCount>0&&(t+=m.instant(e.currentTabConfig.allResultsCountExact?"query.editor.of":"query.editor.of.at.least"),t+=u("currency")(e.currentTabConfig.allResultsCount,"",0)),t+="."}return t},e.getUpdateDescription=function(){return e.currentTabConfig.customUpdateMessage?m.instant(e.currentTabConfig.customUpdateMessage.msg,{name:e.currentTabConfig.customUpdateMessage.name}):void 0===e.currentTabConfig.sizeDelta?"":e.currentTabConfig.sizeDelta<0?m.instant("yasr.removed.statements.result.msg",{sizeDelta:Math.abs(e.currentTabConfig.sizeDelta)}):e.currentTabConfig.sizeDelta>0?m.instant("yasr.added.statements.result.msg",{sizeDelta:e.currentTabConfig.sizeDelta}):m.instant("yasr.statements.no.change.msg")},e.getStaleWarningMessage=function(){const t=60*Math.round((Date.now()-e.currentTabConfig.timeFinished)/6e4);if(t>=3600)return m.instant("yasr.stale.result.msg",{secondsAgo:e.getHumanReadableSeconds(t)})};const k=function(){};angular.element(c).bind("resize",k),e.$on("$destroy",(function(){angular.element(c).unbind("resize",k)}))}function i(e,t,r,n){r.queryExists&&(e.queryExists=!0),e.query=_.cloneDeep(r.query),e.title=r.title,e.edit=r.edit,e.okButtonText=r.okButtonText,e.existingQueryErrMsg=n.trustAsHtml(r.existingQueryErrMsg),e.ok=function(){e.form.$valid&&t.close(e.query)},e.cancel=function(){t.dismiss("cancel")}}angular.module("graphdb.framework.core.directives.queryeditor.controllers",["graphdb.framework.utils.localstorageadapter","graphdb.framework.rest.sparql.service"]).controller("QueryEditorCtrl",a).controller("QuerySampleModalCtrl",i),a.$inject=["$scope","$timeout","toastr","$repositories","$uibModal","ModalService","SparqlRestService","$filter","$window","$jwtAuth","RDF4JRepositoriesRestService","MonitoringRestService","LocalStorageAdapter","LSKeys","$translate"],i.$inject=["$scope","$uibModalInstance","data","$sce"]},66:function(e,t,r){"use strict";r.r(t);r(10);function n(e,t,r,n){return{restrict:"AE",template:'<a class="nav-link" role="tab" data-toggle="tab" blur="submit" editable-text="tab.name" e-form="editCurrentlySelectedOnly" ng-click="selectThisTab($event)" ng-dblclick="editCurrentTab()" ><span ng-class="{\'text-muted\': !tab.name}">{{ tab.name || (\'sparql.tab.directive.unnamed.tab.title\' | translate)}}</span><button type="button" ng-click="deleteTab($event)" class="btn btn-link btn-sm secondary delete-sparql-tab-btn" title="Delete tab"><i class="icon-close"></i></button></a>',replace:!0,controller:["$scope","$element","$rootScope","ModalService","toastr","$translate",function(e,n,a,i,o,s){function u(e){return $(e).attr("data-id")}function c(e){$('a[data-id = "'+e+'"]').tab("show")}e.state={},$(n).on("shown.bs.tab",(function(e){a.$broadcast("tabAction",e)})),e.deleteTab=function(l){if(l.preventDefault(),l.stopPropagation(),e.tabs.length<2)return void o.warning(s.instant("sparql.tab.directive.close.last.warning"));l.shiftKey?(e.state.selectedTabId=u(n),i.openSimpleModal({title:s.instant("common.confirm"),message:s.instant("sparql.tab.directive.delete.all.tabs.warning"),warning:!0}).result.then((function(){var n;n=e.state.selectedTabId,e.tabs=e.tabs.filter((function(e){if(e.id===n)return e})),c(e.tabs[0].id),t.set(r.TABS_STATE,e.tabs),a.$broadcast("deleteAllexeptSelected",e.tabs)}))):(e.state.idForDelete=u(n),i.openSimpleModal({title:s.instant("common.confirm"),message:s.instant("sparql.tab.directive.close.tab.warning"),warning:!0}).result.then((function(){!function(t){if(angular.isUndefined(t))throw"Delete by id was called with undefined id";const r=function(t){for(let r=0;r<e.tabs.length;r++){if(e.tabs[r].id===t)return r}}(t);e.tabs.splice(r,1),t===e.currentQuery.id&&e.tabs.length>0&&c(r>0?e.tabs[r-1].id:e.tabs[0].id)}(e.state.idForDelete)})));angular.element(document).find(".CodeMirror textarea:first-child").focus()},e.editCurrentTab=function(){if(u(n)!==e.currentQuery.id)return;e.editCurrentlySelectedOnly.$show();const t=$(".editable-buttons");t.children(".btn.btn-primary").addClass("btn-sm"),t.children(".btn.btn-default").addClass("btn-sm"),$(".editable-controls .editable-input").addClass("form-control-sm").on("change",(function(t){e.currentQuery.name=t.currentTarget.$$currentValue})),$(".editable-buttons .glyphicon.glyphicon-ok").removeClass("glyphicon glyphicon-ok").addClass("fa fa-check"),$(".editable-buttons .glyphicon.glyphicon-remove").removeClass("glyphicon glyphicon-remove").addClass("fa fa-close")},e.selectThisTab=function(t){t.preventDefault(),t.stopPropagation(),e.isTabChangeOk(!1)&&$(n).tab("show")}}]}}angular.module("graphdb.framework.core.directives.queryeditor.sparqltab",["graphdb.framework.core","graphdb.framework.utils.localstorageadapter"]).directive("sparqlTab",n),n.$inject=["$rootScope","LocalStorageAdapter","LSKeys","ModalService"]}}]);