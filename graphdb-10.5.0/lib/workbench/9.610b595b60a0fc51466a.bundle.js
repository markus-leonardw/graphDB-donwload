(window.webpackJsonp=window.webpackJsonp||[]).push([[9,79,118],{141:function(t,e,n){"use strict";n.r(e);n(10);var o=n(91),r=n(77),a=n(318);n(92);let s=240;const c=angular.module("graphdb.framework.clustermanagement.directives",["graphdb.framework.utils.localstorageadapter"]),i={no_cluster_configured:"",create_cluster_btn:"",legend_node_state:"",legend_link_state:"",node_state_leader:"Leader",node_state_follower:"Follower",node_state_candidate:"Candidate",node_state_no_cluster:"No cluster",node_state_out_of_sync:"Out of sync",node_state_no_connection:"No connection",node_state_read_only:"Read only",node_state_restricted:"Restricted",link_state_in_sync:"In sync",link_state_syncing:"Syncing",link_state_out_of_sync:"Out of sync",recovery_state:{searching_for_node:"Searching for node",waiting_for_snapshot:"Waiting for snapshot from node",receiving_snapshot:"Receiving a snapshot from node",applying_snapshot:"Applying a snapshot",building_snapshot:"Building a snapshot for node",sending_snapshot:"Sending a snapshot to node"}},d={node_state:"legend_node_state",link_state:"legend_link_state"};c.directive("clusterGraphicalView",["$window","LocalStorageAdapter","LSKeys","UriUtils","$translate","$rootScope",function(t,e,n,r,c,f){return{restrict:"A",link:function(p,h){const y=p.isAdmin();function S(t,e=""){Object.keys(t).forEach(n=>{let o="";e&&(o+=e),o+="."+n;const r=t[n];"string"==typeof r?t[n]=c.instant("cluster_management.cluster_graphical_view"+o):"object"==typeof r&&S(r,o)})}function g(){const o="collapsedMenu"===e.get(n.MENU_STATE);return s=o?70:240,Math.max(Math.floor(.95*(t.innerWidth-s)),600)}function N(){return Math.max(.95*(t.innerHeight-250),600)}let m,x,v;p.showLegend=!1,f.$on("$translateChangeSuccess",(function(){S(i),function(){o.updateClusterZoneLabels(T,E,i),Object.keys(d).forEach(t=>{d3.select("#"+t).text(G(t))}),m&&m.remove();P(),F()}()})),p.$on("$destroy",(function(){B.destroy()}));let T,O,E,C,w,k,A=g(),L=N(),I=Math.min(A,L)/2-100,b=A/2,R=L/2;function G(t){return i[d[t]]}function P(){m=O.append("g").attr("id","legend-group").classed("hidden",!p.showLegend).classed("legend-group",!0)}p.width=function(){return A},p.height=function(){return L};const B=Object(a.a)().attr("class","d3-tip").customPosition((function(){const t=k.getBoundingClientRect(),e=document.documentElement.scrollTop||document.body.scrollTop,n=document.documentElement.scrollLeft||document.body.scrollLeft;return{left:t.left+n+"px",top:t.top-30+e+"px"}})).html((function(t){return t.toolTip})),D=function(t,e){k=e,B.show(t,k)},H=function(){k=null,B.hide()};function F(){const t=l(),e=u();!function(t,e){t.forEach(t=>{const e=_.get(i,t.customText);t.toolTip=t.hostname=e}),e.forEach(t=>{t.toolTip=t.linkTypeText=i[t.linkTypeKey]})}(t,e),m.append("rect").attr("id","legend-background").attr("class","legend-background").attr("fill","#EEEEEE");const n=m.append("text").attr("id","node_state").attr("class","id id-host").attr("x",200).attr("y",24).text(G("node_state")),r=m.append("text").attr("id","link_state").attr("class","id id-host").attr("x",200).attr("y",319).text(G("link_state")),a=m.selectAll("#node-group").data(t),s=o.createNodes(a,25,!0);o.updateNodes(s),s.select(".node.member").on("mouseover",(function(t,e){t.stopPropagation(),D(e,this)})).on("mouseout",H),s.attr("transform",(function(t){const e=Math.floor(t.id/4);return`translate(${35+65*(t.id%4)}, ${59+65*e})`})),m.call((function(t){x=t.node().getBBox().width})),n.attr("x",10+x/2),r.attr("x",10+x/2);const c=x/3,d=m.append("g").attr("id","links-group");d.attr("transform","translate(10, 329)"),e.forEach((t,e)=>{const n=c-5,r=d.append("g").classed("link",!0).classed("legend",!0).attr("transform",()=>`translate(${e*c}, 0)`);r.append("path").classed("link",!0).attr("stroke-dasharray",()=>o.setLinkStyle(t)).attr("stroke",()=>o.setLinkColor(t)).attr("d",()=>`M5,0,${n},0`),r.append("foreignObject").attr("y",10).attr("x",5).attr("width",c-10).attr("height",10).attr("class","label-wrapper").append("xhtml:div").attr("class","id id-host").style("font-size","9px").html(t.linkTypeText),r.on("mouseover",(function(e){e.stopPropagation(),D(t,this)})).on("mouseout",H)}),m.call((function(t){v=t.node().getBBox().height,x=t.node().getBBox().width})),m.select(".legend-background").attr("height",v+50).attr("width",x+20).attr("rx","6"),M()}function M(){const t=L-(v+40+50);o.moveElement(m,0,t)}function Y(){I=Math.min(A,L)/2-100,b=A/2,R=L/2,o.moveElement(E,b,R),E.select(".cluster-zone").attr("r",I)}function U(){Y(),T!==p.clusterModel.hasCluster&&(T=!!p.clusterModel.hasCluster,function(t){let e;o.setCreateClusterZone(t,E,i,y),!t&&y&&(e=()=>{p.$apply((function(){p.showCreateClusterDialog()}))}),E.on("mouseup",e)}(T));const t=_.cloneDeep(p.clusterModel.nodes)||[],e=_.cloneDeep(p.clusterModel.links)||[];!function(t){t.forEach(t=>{if(t.hostname=r.shortenIri(t.endpoint),!_.isEmpty(t.recoveryStatus)){let e="cluster_management.cluster_graphical_view.recovery_state."+t.recoveryStatus.state.toLowerCase();t.recoveryStatus.affectedNodes&&t.recoveryStatus.affectedNodes.length>0&&(e+="_with_affected_node"),t.recoveryStatus.message=c.instant(e,{node:t.recoveryStatus.affectedNodes.join(", ")})}});const e=C.selectAll("#node-group").data(t,t=>t.address),n=o.createNodes(e,50);n.on("click",(t,e)=>{p.childContext.selectNode(e);const n=d3.select(".nodetooltip"),o=$(window).width();t.pageX<o/2?(n.style("left",t.pageX+"px"),n.style("right","")):(n.style("left",""),n.style("right",o-t.pageX+"px")),n.style("top",t.pageY-28+"px")}),o.updateNodes(n),o.positionNodesOnClusterZone(n,b,R,I)}(t),function(t,e){const n=w.selectAll(".link").data(t,t=>t.id);o.createLinks(n),o.updateLinks(n,e)}(e,t)}p.childContext.redraw=U,p.childContext.resize=function(){A=g(),L=N(),O.attr("width",A),O.attr("height",L),U(),M()},p.childContext.toggleLegend=()=>{p.showLegend=!p.showLegend,m.classed("hidden",!p.showLegend)},S(i),function(t){O=o.createClusterSvgElement(h[0]).attr("width",A).attr("height",L),O.call(B),E=o.createClusterZone(O,t),w=O.append("g").attr("id","links-group"),C=O.append("g").attr("id","nodes-group"),P()}(!(!p.clusterModel.nodes||!p.clusterModel.nodes.length)),F(),U()}}}]);const l=function(){const t=[];return t.push({nodeState:r.NodeState.LEADER,customText:"node_state_leader"}),t.push({nodeState:r.NodeState.FOLLOWER,customText:"node_state_follower"}),t.push({nodeState:r.NodeState.CANDIDATE,customText:"node_state_candidate"}),t.push({nodeState:r.NodeState.NO_CLUSTER,customText:"node_state_no_cluster"}),t.push({nodeState:r.NodeState.OUT_OF_SYNC,customText:"node_state_out_of_sync"}),t.push({nodeState:r.NodeState.NO_CONNECTION,customText:"node_state_no_connection"}),t.push({nodeState:r.NodeState.READ_ONLY,customText:"node_state_read_only"}),t.push({nodeState:r.NodeState.RESTRICTED,customText:"node_state_restricted"}),t.push({nodeState:r.NodeState.OUT_OF_SYNC,customText:"recovery_state.searching_for_node",recoveryStatus:{state:r.RecoveryState.SEARCHING_FOR_NODE}}),t.push({nodeState:r.NodeState.OUT_OF_SYNC,customText:"recovery_state.waiting_for_snapshot",recoveryStatus:{state:r.RecoveryState.WAITING_FOR_SNAPSHOT}}),t.push({nodeState:r.NodeState.OUT_OF_SYNC,customText:"recovery_state.receiving_snapshot",recoveryStatus:{state:r.RecoveryState.RECEIVING_SNAPSHOT}}),t.push({nodeState:r.NodeState.OUT_OF_SYNC,customText:"recovery_state.applying_snapshot",recoveryStatus:{state:r.RecoveryState.APPLYING_SNAPSHOT}}),t.push({nodeState:r.NodeState.OUT_OF_SYNC,customText:"recovery_state.building_snapshot",recoveryStatus:{state:r.RecoveryState.BUILDING_SNAPSHOT}}),t.push({nodeState:r.NodeState.OUT_OF_SYNC,customText:"recovery_state.sending_snapshot",recoveryStatus:{state:r.RecoveryState.SENDING_SNAPSHOT}}),t.forEach((t,e)=>t.id=e),t},u=function(){const t=[];return t.push({status:r.LinkState.IN_SYNC,linkTypeKey:"link_state_in_sync"}),t.push({status:r.LinkState.SYNCING,linkTypeKey:"link_state_syncing"}),t.push({status:r.LinkState.OUT_OF_SYNC,linkTypeKey:"link_state_out_of_sync"}),t.forEach((t,e)=>t.id=e),t}},318:function(t,e,n){"use strict";e.a=function(){var t=function(){return"n"},e=function(){return[0,0]},n=function(){return" "},o=u(),r=null,a=null,s=null,c=null;function i(t){var e;r="svg"===(e=(e=t).node()).tagName.toLowerCase()?e:e.ownerSVGElement,a=r.createSVGPoint(),document.body.appendChild(o)}i.show=function(){var o=Array.prototype.slice.call(arguments);o[o.length-1]instanceof SVGElement&&(s=o.pop());var r,a=n.apply(this,o),u=e.apply(this,o),p=t.apply(this,o),h=f(),_=l.length,y=document.documentElement.scrollTop||document.body.scrollTop,S=document.documentElement.scrollLeft||document.body.scrollLeft,g=c.apply(this,o);for(h.html(a).style("opacity",1).style("pointer-events","all");_--;)h.classed(l[_],!1);const N=o.filter(t=>t instanceof Event);return r=d.get(p).apply(this,N),g?Object.keys(g).forEach((function(t){h.style(t,g[t])})):h.classed(p,!0).style("top",r.top+u[0]+y+"px").style("left",r.left+u[1]+S+"px"),i},i.hide=function(){return f().style("opacity",0).style("pointer-events","none"),i},i.attr=function(t,e){if(arguments.length<2&&"string"==typeof t)return f().attr(t);var n=Array.prototype.slice.call(arguments);return d3.selection.prototype.attr.apply(f(),n),i},i.style=function(t,e){if(arguments.length<2&&"string"==typeof t)return f().style(t);var n=Array.prototype.slice.call(arguments);return d3.selection.prototype.style.apply(f(),n),i},i.direction=function(e){return arguments.length?(t=null==e?e:h(e),i):t},i.offset=function(t){return arguments.length?(e=null==t?t:h(t),i):e},i.html=function(t){return arguments.length?(n=null==t?t:h(t),i):n},i.customPosition=function(t){return arguments.length?(c=null==t?t:h(t),i):c},i.destroy=function(){return o&&(f().remove(),o=null),i};var d=new Map(Object.entries({n:function(t){var e=p(t);return{top:e.n.y-o.offsetHeight,left:e.n.x-o.offsetWidth/2}},s:function(t){var e=p(t);return{top:e.s.y,left:e.s.x-o.offsetWidth/2}},e:function(t){var e=p(t);return{top:e.e.y-o.offsetHeight/2,left:e.e.x}},w:function(t){var e=p(t);return{top:e.w.y-o.offsetHeight/2,left:e.w.x-o.offsetWidth}},nw:function(t){var e=p(t);return{top:e.nw.y-o.offsetHeight,left:e.nw.x-o.offsetWidth}},ne:function(t){var e=p(t);return{top:e.ne.y-o.offsetHeight,left:e.ne.x}},sw:function(t){var e=p(t);return{top:e.sw.y,left:e.sw.x-o.offsetWidth}},se:function(t){var e=p(t);return{top:e.se.y,left:e.e.x}}})),l=d.keys();function u(){var t=d3.select(document.createElement("div"));return t.style("position","absolute").style("top",0).style("opacity",0).style("pointer-events","none").style("box-sizing","border-box"),t.node()}function f(){return null===o&&(o=u(),document.body.appendChild(o)),d3.select(o)}function p(t){for(var e=s||t.target;void 0===e.getScreenCTM&&"undefined"===e.parentNode;)e=e.parentNode;var n={},o=e.getScreenCTM(),r=e.getBBox(),c=r.width,i=r.height,d=r.x,l=r.y;return a.x=d,a.y=l,n.nw=a.matrixTransform(o),a.x+=c,n.ne=a.matrixTransform(o),a.y+=i,n.se=a.matrixTransform(o),a.x-=c,n.sw=a.matrixTransform(o),a.y-=i/2,n.w=a.matrixTransform(o),a.x+=c,n.e=a.matrixTransform(o),a.x-=c/2,a.y-=i/2,n.n=a.matrixTransform(o),a.y+=i,n.s=a.matrixTransform(o),n}function h(t){return"function"==typeof t?t:function(){return t}}return i}},91:function(t,e,n){"use strict";n.r(e),n.d(e,"clusterColors",(function(){return r})),n.d(e,"createClusterSvgElement",(function(){return a})),n.d(e,"createClusterZone",(function(){return s})),n.d(e,"setCreateClusterZone",(function(){return c})),n.d(e,"updateClusterZoneLabels",(function(){return i})),n.d(e,"moveElement",(function(){return d})),n.d(e,"createNodes",(function(){return l})),n.d(e,"updateNodes",(function(){return u})),n.d(e,"createLinks",(function(){return p})),n.d(e,"updateLinks",(function(){return h})),n.d(e,"setLinkColor",(function(){return y})),n.d(e,"setLinkStyle",(function(){return S})),n.d(e,"positionNodesOnClusterZone",(function(){return g}));var o=n(77);const r={ontoOrange:"var(--primary-color)",ontoBlue:"var(--secondary-color)",ontoGreen:"var(--tertiary-color)",ontoGrey:"var(--gray-color)"};function a(t){return d3.select(t).append("svg")}function s(t){const e=t.append("g");return e.append("circle").classed("cluster-zone",!0).style("fill","transparent").style("stroke-width","2"),e}function c(t,e,n,o=!1){if(e.select(".cluster-zone").classed("no-cluster",!t).classed("has-access",o),t)e.selectAll("#no-cluster-zone").remove();else{const t=e.append("g").attr("id","no-cluster-zone");t.append("text").attr("id","no-cluster-label").text(n.no_cluster_configured).attr("y",-50).classed("h2",!0).style("text-anchor","middle"),o&&t.append("text").attr("id","create-cluster-label").classed("h3",!0).text(n.create_cluster_btn).style("text-anchor","middle"),t.append("text").attr("y",130).attr("class","icon-any repo").attr("fill",r.ontoOrange).style("text-anchor","middle").classed("settings-icon",!0).text("")}}function i(t,e,n){t||(e.select("#no-cluster-zone #no-cluster-label").text(n.no_cluster_configured),e.select("#no-cluster-zone #create-cluster-label").text(n.create_cluster_btn))}function d(t,e,n){t.attr("transform",()=>`translate(${e}, ${n})`)}function l(t,e,n){const o=t.enter().append("g").attr("id","node-group").classed("legend",n),r=o.merge(t).attr("id","node-group").classed("legend",n);return function(t,e){const n=Math.sqrt(3)/2,o=[[e+0,0],[e/2+0,e*n+0],[-e/2+0,e*n+0],[0-e,0],[-e/2+0,-e*n+0],[e/2+0,-e*n+0],[e+0,0],[e/2+0,e*n+0]];t.selectAll("path.area").data([o]).enter().append("path").attr("class","node member").attr("d",d3.line())}(o,e),t.exit().remove(),o.append("text").attr("class","icon-any node-icon"),function(t,e,n){const o=t.append("g");n?o.append("foreignObject").attr("y",e).attr("x",-e).attr("width",2*e).attr("height",10).attr("class","label-wrapper").append("xhtml:div").attr("class","id id-host"):(o.append("rect").attr("class","id-host-background").attr("rx",6),o.append("text").attr("y",e+15).attr("class","id id-host"),o.append("rect").attr("class","node-info-background").attr("rx",6),o.append("text").attr("y",e+45).attr("class","node-info-text"))}(o,e,n),r}function u(t){!function(t){t.select(".node-icon").classed("icon-any",(function(t){return!f(t)})).classed("fa-d3",f).text((function(t){return f(t)?function(t){if(_.isEmpty(t.recoveryStatus))return"";switch(t.recoveryStatus.state){case o.RecoveryState.SEARCHING_FOR_NODE:return"";case o.RecoveryState.WAITING_FOR_SNAPSHOT:return"";case o.RecoveryState.RECEIVING_SNAPSHOT:return"";case o.RecoveryState.APPLYING_SNAPSHOT:return"";case o.RecoveryState.BUILDING_SNAPSHOT:return"";case o.RecoveryState.SENDING_SNAPSHOT:return"";default:return""}}(t):function(t){if(t.nodeState===o.NodeState.LEADER)return"";if(t.nodeState===o.NodeState.FOLLOWER)return"";if(t.nodeState===o.NodeState.CANDIDATE)return"";if(t.nodeState===o.NodeState.NO_CONNECTION)return"";if(t.nodeState===o.NodeState.OUT_OF_SYNC)return"";if(t.nodeState===o.NodeState.READ_ONLY)return"";if(t.nodeState===o.NodeState.RESTRICTED)return"";return""}(t)}))}(t),function(t){t.select(".node.member").classed("leader",t=>t.nodeState===o.NodeState.LEADER).classed("follower",t=>t.nodeState===o.NodeState.FOLLOWER).classed("candidate",t=>t.nodeState===o.NodeState.CANDIDATE).classed("other",t=>t.nodeState!==o.NodeState.LEADER&&t.nodeState!==o.NodeState.FOLLOWER&&t.nodeState!==o.NodeState.CANDIDATE)}(t),function(t){t.select(".id.id-host").each((function(t){t.labelNode=this})).text((function(t){return t.hostname})),t.select(".id-host-background").attr("width",(function(t){return d3.select(t.labelNode).node().getBBox().width+10})).attr("height",(function(t){return d3.select(t.labelNode).node().getBBox().height+10})).attr("x",(function(t){return d3.select(t.labelNode).node().getBBox().x-5})).attr("y",(function(t){return d3.select(t.labelNode).node().getBBox().y-5}))}(t),function(t){t.select(".node-info-text").each((function(t){t.infoNode=this})).text((function(t){return t.recoveryStatus&&t.recoveryStatus.message})),t.select(".node-info-background").attr("width",(function(t){return d3.select(t.infoNode).node().getBBox().width+10})).attr("height",(function(t){return d3.select(t.infoNode).node().getBBox().height+10})).attr("x",(function(t){return d3.select(t.infoNode).node().getBBox().x-5})).attr("y",(function(t){return d3.select(t.infoNode).node().getBBox().y-5})).classed("hidden",(function(t){return _.isEmpty(t.recoveryStatus)}))}(t)}function f(t){return!_.isEmpty(t.recoveryStatus)}function p(t){t.enter().append("path").classed("link",!0),t.exit().remove()}function h(t,e){t.attr("stroke",y).style("stroke-dasharray",S).attr("d",t=>function(t,e){const n=e.find(e=>e.address===t.source),o=e.find(e=>e.address===t.target),r=o.x-n.x,a=o.y-n.y,s=Math.sqrt(r*r+a*a),c=r/s,i=a/s,d=n.x+55*c,l=n.y+55*i,u=o.x-55*c,f=o.y-55*i;return"M"+d+","+l+"L"+u+","+f}(t,e))}function y(t){return t.status===o.LinkState.IN_SYNC||t.status===o.LinkState.SYNCING?r.ontoGreen:t.status===o.LinkState.OUT_OF_SYNC?r.ontoGrey:"none"}function S(t){return t.status===o.LinkState.OUT_OF_SYNC||t.status===o.LinkState.SYNCING?"10 10":"none"}function g(t,e,n,o){t.attr("transform",(r,a)=>{const s=2*Math.PI*a/t.size(),c=e+Math.cos(s)*o,i=n+Math.sin(s)*o;return r.x=c,r.y=i,`translate(${c}, ${i})`})}},92:function(t,e,n){"use strict";n.r(e),n.d(e,"RecoveryStatusState",(function(){return o}));const o={SEARCHING_FOR_NODE:"SEARCHING_FOR_NODE",WAITING_FOR_SNAPSHOT:"WAITING_FOR_SNAPSHOT",RECEIVING_SNAPSHOT:"RECEIVING_SNAPSHOT",APPLYING_SNAPSHOT:"APPLYING_SNAPSHOT",BUILDING_SNAPSHOT:"BUILDING_SNAPSHOT",SENDING_SNAPSHOT:"SENDING_SNAPSHOT"}}}]);