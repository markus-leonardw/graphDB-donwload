(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{102:function(e,r,n){"use strict";n.r(r);n(10);function t(e,r,n,t,s,a,o,i,c,l,u,p,d,h,g,f,m){e.classHierarchyData={},e.instancesObj={},e.instancesQueryObj={},e.instancesObj.items=[],e.instancesNotFiltered=[],e.isWarningShowed=!1,e.onopen=e.onclose=()=>angular.noop(),e.currentBrowserLimit=2e3,d.firefox?e.currentBrowserLimit=50:(d.safari||d.msie||d.msedge)&&(e.currentBrowserLimit=400);const C={};let y=0,S=0;r.key="",C.get=function(r,n,t){return c.initLazyList(r,n,t,y,e.instancesObj.items)};let w=allGraphs;const b=function(){if(e.getActiveRepository())return f.resolveGraphs().success((function(r){e.graphsInRepo=r.results.bindings.length>1002?r.results.bindings.slice(0,1002):r.results.bindings,R()})).error((function(r){e.repositoryError=getError(r),o.error(getError(r),m.instant("graphexplore.error.getting.graphs"))}))},R=function(){const r=h.get("classHierarchy-selectedGraph-"+t.getActiveRepository());null!==r&&e.graphsInRepo.some(e=>e.contextID.uri===r.contextID.uri)?w=r:h.set("classHierarchy-selectedGraph-"+t.getActiveRepository(),w)};function v(r,n,t){e.classCountSlider.options&&e.classCountSlider.options.ceil!==n&&(e.classCountSlider={});var s;e.classCountSlider.value||(e.showExternalElements=!0,e.classCountSlider={value:n,options:{floor:1,ceil:n,vertical:!0,showSelectionBar:!0,onChange:function(){u(E,100,!0)}}},null===h.get(g.CLASS_HIERARCHY_CURRENT_SLIDER_VALUE)&&n>e.currentBrowserLimit&&(s=e.currentBrowserLimit,d.chrome?o.warning(m.instant("graphexplore.disabling.animations",{classLimit:s}),m.instant("graphexplore.reducing.visual.effects")):o.warning(m.instant("graphexplore.browser.performance",{browser:d.name,classLimit:s}),m.instant("graphexplore.reducing.visual.effects"))));const a=h.get(g.CLASS_HIERARCHY_SWITCH_PREFIXES);null!=a&&"true"!==a&&(e.showExternalElements=!0),t?e.classCountSlider.value=t:n>=1500&&(e.classCountSlider.value=1500,o.warning(m.instant("graphexplore.class.count.slider",{count:1500}),m.instant("graphexplore.reducing.class.count"))),n>=25&&!window.ActiveXObject&&"ActiveXObject"in window&&!e.isWarningShowed&&(e.classCountSlider.value=25,e.isWarningShowed=!0,o.warning(m.instant("graphexplore.class.count.browser",{count:25}),m.instant("graphexplore.reducing.class.count"))),u((function(){e.$broadcast("reCalcViewDimensions")}),200),E();let i=0;$("rzslider").on("wheel",(function(r){r.preventDefault(),r.stopPropagation();const n=(new Date).getTime();if(!(n-i>100))return;i=n,r=r.originalEvent;let t=e.classCountSlider.value;r.deltaY<=-1?t+=1:r.deltaY>=1&&(t-=1),t!==e.classCountSlider.value&&t>=e.classCountSlider.options.floor&&t<=e.classCountSlider.options.ceil&&e.$apply((function(){e.classCountSlider.value=t,u(E,100,!0)}))}))}function E(){e.currentSliderValue=e.classCountSlider.value}function x(e){const r=e.data.fullName,t=e.data.name;i.checkDomainRangeData(r).success((function(e,s){204===s?o.warning(m.instant("graphexplore.no.domain.range",{name:t})):(h.set(g.CLASS_HIERARCHY_LAST_SELECTED_CLASS,n.hash()),n.hash("").path("domain-range-graph").search("uri",r).search("name",t))})).error((function(){o.error(m.instant("graphexplore.error.request.failed",{name:t}))}))}function L(){n.replace().hash("1"),e.instancesObj.items=[],e.showExternalElements=!1,e.showClassInfoPanel=!1,h.clearClassHieararchyState(),e.hidePrefixes="true"===h.get(g.CLASS_HIERARCHY_HIDE_PREFIXES),e.currentSliderValue=void 0,e.classHierarchyData={},r.$broadcast("angucomplete-alt:clearInput")}function I(){e.hasClassHierarchy()&&u((function(){$("#toolbar").removeClass("ng-hide")}),0)}r.$watch((function(){return r.key}),(function(){y=0,_.each(e.instancesObj.items,(function(e){r.key>e&&y++})),S++})),C.revision=function(){return S},e.adapterContainer={adapter:{remain:!0}},e.$on("goToDomainRangeGraphView",(function(e,r){x(r)})),e.$on("classCount",v),e.$on("repositoryIsSet",(function(){if(!s.isLicenseValid())return;if(A===t.getActiveRepository())return;A=t.getActiveRepository();if(e.repositoryError=null,!A)return;w=allGraphs,b().then(H)})),e.datasource=C,e.goToDomainRangeGraphView=x,e.toggleClassInfoSidePanel=function(){e.showClassInfoPanel=!e.showClassInfoPanel,r.$broadcast("sidePanelClosed")},e.getActiveRepositoryNoError=function(){if(!e.repositoryError)return t.getActiveRepository()},e.isSystemRepository=function(){return t.isSystemRepository()},e.confirmReloadClassHierarchy=function(){p.openSimpleModal({title:m.instant("confirm.operation"),message:m.instant("graphexplore.calculating.hierarchy"),warning:!0}).result.then((function(){L(),e.loader=!0,e.hierarchyError=!1,i.reloadClassHierarchy(w.contextID.uri).success((function(r){e.loader=!1,e.classHierarchyData=r,I(),v()})).error((function(r){e.loader=!1,e.hierarchyError=getError(r),o.error(getError(r),m.instant("graphexplore.error.rdf.class.request"))}))}))},e.focusOnRoot=function(){e.$broadcast("rootFocus")},e.copyToClipboard=function(e){p.openCopyToClipboardModal(e)},e.searchedClassCallback=function(e){if(e){const n={name:e.title};r.$broadcast("searchedClass",n)}},e.instancesQueryObj.query="",e.instancesFilterFunc=function(r){return r.resolvedUri.toLowerCase().indexOf(e.instancesQueryObj.query.toLowerCase())>=0},b(),e.$watch("instancesObj.items",(function(){e.instancesObj.items.length>0&&u((function(){e.adapterContainer.adapter.reload()}),30)})),e.$watch("selectedClass",(function(){e.showClassInfoPanel&&function(r){const n=r.data.fullName;let t=r.data.name;if(t===n){const e=t.lastIndexOf("#");t=t.substring(e+1)}e.encodedUri=encodeURIComponent(n);const s=encodeURIComponent("prefix onto:<http://www.ontotext.com/>\nselect ?s {\n    ?s a <"+n+"> .\n}");e.viewInstancesUri="sparql?name="+t+"&infer=true&sameAs=false&query="+s+"&execute=true",i.getRdfsLabelAndComment(n).success((function(r){e.rdfsLabel=r.label,e.rdfsComment=r.comment,e.expanded=!1})).error((function(){o.error("Error getting rdfs:label and rdfs:comment")})),e.instancesQueryObj.query="",e.instancesLoader=!0,i.getClassInstances(n).success((function(r){e.instancesObj.items=[],_.each(r,(function(r,n){const t={};t.type=r.startsWith("<<")&&r.endsWith(">>")?"triple":"uri",t.absUri=encodeURIComponent(r),t.absUriNonEncoded=r,t.resolvedUri=n,e.instancesObj.items.push(t)})),e.instancesLoader=!1,e.instancesSearchPlaceholder=e.instancesObj.items.length<1e3?"Search class instances":"Search first 1000 class instances",e.instancesNotFiltered=e.instancesObj.items})).error((function(){o.error(m.instant("graphexplore.error.instances.request"))}))}(e.selectedClass)})),$(document).ready((function(){$(".prefix-toggle").click((function(){$(".tooltip").hide()}))}));let A=t.getActiveRepository();function H(){L(),!e.isSystemRepository()&&e.isLicenseValid()&&(e.hierarchyError=!1,e.loader=!0,i.getClassHierarchyData(w.contextID.uri).success((function(r,n){e.showExternalElements=!0,e.loader=!1,e.classHierarchyData=r,207===n&&o.warning(m.instant("graphexplore.update.diagram"),m.instant("graphexplore.repository.data.changed")),I()})).error((function(r){e.loader=!1,e.hierarchyError=getError(r),o.error(getError(r),m.instant("graphexplore.error.rdf.class.request"))})))}e.hasClassHierarchy=function(){return e.classHierarchyData.classCount&&e.getActiveRepositoryNoError()&&!e.isSystemRepository()},e.isLicenseValid=function(){return s.isLicenseValid()},e.chosenGraph=function(e){w=e,H(),h.set("classHierarchy-selectedGraph-"+t.getActiveRepository(),w)},e.getSelGraphValue=function(){return w.contextID.value},e.isAllGraphsSelected=function(){return"all.graphs.label"===e.getSelGraphValue()}}angular.module("graphdb.framework.graphexplore.controllers.class",["pageslide-directive","ngAnimate","ui.scroll.jqlite","ui.scroll","angucomplete-alt","rzSlider","toastr","graphdb.framework.utils.localstorageadapter"]).controller("RdfClassHierarchyCtlr",t),t.$inject=["$scope","$rootScope","$location","$repositories","$licenseService","$window","toastr","GraphDataRestService","UiScrollService","RdfsLabelCommentService","$timeout","ModalService","bowser","LocalStorageAdapter","LSKeys","RDF4JRepositoriesRestService","$translate"]}}]);