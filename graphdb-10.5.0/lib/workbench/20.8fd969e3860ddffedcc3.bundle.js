(window.webpackJsonp=window.webpackJsonp||[]).push([[20,22,32,39,68,147],{146:function(e,t,s){"use strict";s.r(t);s(7),s(23),s(29),s(75),s(80),s(22);angular.module("graphdb.framework.aclmanagement",["ui.bootstrap","toastr","ngCookies","ngRoute","graphdb.framework.aclmanagement.controllers","graphdb.framework.core.services.repositories","graphdb.framework.core.directives","graphdb.framework.core.controllers"])},59:function(e,t,s){"use strict";s.r(t),s.d(t,"mapNamespacesResponse",(function(){return l}));const l=e=>e&&e.data?e.data.results.bindings.map(e=>({prefix:e.prefix.value,uri:e.namespace.value})):[]},62:function(e,t,s){"use strict";s.r(t),s.d(t,"mapAclRulesResponse",(function(){return r}));var l=s(63);const r=e=>{const t=new l.ACListModel;return e&&e.data&&e.data.forEach(e=>{t.appendNewRule(e.subject,e.predicate,e.object,e.context,e.role,e.policy)}),t}},63:function(e,t,s){"use strict";s.r(t),s.d(t,"ACListModel",(function(){return l})),s.d(t,"ACRuleModel",(function(){return r})),s.d(t,"ACL_POLICY",(function(){return o}));class l{constructor(e=[]){this._aclRules=e}size(){return this.aclRules.length}appendNewRule(e,t,s,l,o,n){this.aclRules.push(new r(e,t,s,l,o,n))}addRule(e){this.aclRules.splice(e,0,new r)}removeRule(e){this.aclRules.splice(e,1)}replaceRule(e,t){this.aclRules.splice(e,1,t)}getRule(e){return this.aclRules[e]}isRuleDuplicated(e){const t=this.aclRules[e];return this.aclRules.some((s,l)=>e!==l&&angular.equals(t,s))}getRuleCopy(e){const t=this.aclRules[e];return{subject:t.subject,predicate:t.predicate,object:t.object,context:t.context,role:t.role,policy:t.policy}}moveUp(e){const t=this.aclRules[e-1];this.aclRules[e-1]=this.aclRules[e],this.aclRules[e]=t}moveDown(e){const t=this.aclRules[e+1];this.aclRules[e+1]=this.aclRules[e],this.aclRules[e]=t}toJSON(){return this.aclRules.map(e=>({subject:e.subject,predicate:e.predicate,object:e.object,context:e.context,role:e.role,policy:e.policy}))}get aclRules(){return this._aclRules}set aclRules(e){this._aclRules=e}}class r{constructor(e="*",t="*",s="*",l="*",r="CUSTOM_",n=o.ALLOW){this._subject=e,this._predicate=t,this._object=s,this._context=l,this._role=r,this._policy=n}get subject(){return this._subject}set subject(e){this._subject=e}get predicate(){return this._predicate}set predicate(e){this._predicate=e}get object(){return this._object}set object(e){this._object=e}get context(){return this._context}set context(e){this._context=e}get role(){return this._role}set role(e){this._role=e}get policy(){return this._policy}set policy(e){this._policy=e}}const o={ALLOW:"allow",DENY:"deny"}},76:function(e,t,s){"use strict";s.r(t);s(62);angular.module("graphdb.framework.rest.aclmanagement.service",[]).factory("AclManagementRestService",l),l.$inject=["$http"];function l(e){return{getAcl:function(t){return e.get(`rest/repositories/${t}/acl`)},updateAcl:function(t,s){return e.put(`rest/repositories/${t}/acl`,s)}}}},80:function(e,t,s){"use strict";s.r(t);s(30),s(76);var l=s(62),r=s(74),o=s(59);function n(e,t,s,n,a,c,i,u,d){e.contextValue=void 0;const p=[];e.ruleData={},e.loading=!1,e.namespaces=[],e.rulesModel=void 0,e.rulesModelCopy=void 0,e.selectedRule=void 0,e.editedRuleIndex=void 0,e.editedRuleCopy=void 0,e.isNewRule=!1,e.modelIsDirty=!1,e.addRule=t=>{e.rulesModel.addRule(t),e.editedRuleIndex=t,e.isNewRule=!0,v()},e.editRule=t=>{e.editedRuleIndex=t,e.isNewRule=!1,e.editedRuleCopy=e.rulesModel.getRuleCopy(t),v()},e.deleteRule=t=>{i.openConfirmation(c.instant("common.confirm"),c.instant("acl_management.rulestable.messages.delete_rule_confirmation",{index:t}),()=>{e.rulesModel.removeRule(t),v()})},e.saveRule=()=>{e.rulesModel.isRuleDuplicated(e.editedRuleIndex)?f():(e.editedRuleIndex=void 0,e.isNewRule=!1,v())},e.cancelEditing=t=>{e.isNewRule?(e.rulesModel.removeRule(t),e.isNewRule=!1):(e.rulesModel.replaceRule(t,e.editedRuleCopy),e.editedRuleCopy=void 0),e.editedRuleIndex=void 0,v()},e.moveUp=t=>{e.rulesModel.moveUp(t),e.selectedRule=t-1,v()},e.moveDown=t=>{e.rulesModel.moveDown(t),e.selectedRule=t+1,v()},e.saveAcl=()=>{e.loading=!0,R().then(m).catch(e=>{const t=getError(e);s.error(t,c.instant("acl_management.errors.updating_rules"))}).finally(()=>{e.loading=!1})},e.cancelAclSave=()=>{i.openConfirmation(c.instant("common.confirm"),c.instant("acl_management.rulestable.messages.revert_acl_list"),()=>{g(),s.success(c.instant("acl_management.rulestable.messages.rules_reverted"))})};const m=()=>{const t=b();return n.getAcl(t).then(t=>{e.rulesModel=Object(l.mapAclRulesResponse)(t),e.rulesModelCopy=Object(l.mapAclRulesResponse)(t),v()}).catch(e=>{const t=getError(e);s.error(t,c.instant("acl_management.errors.loading_rules"))})},R=()=>{const t=b();return n.updateAcl(t,e.rulesModel.toJSON()).then(()=>{s.success(c.instant("acl_management.rulestable.messages.rules_updated"))})},g=()=>{b()&&(e.loading=!0,m().finally(()=>{e.loading=!1}))},h=()=>{g(),e.editedRuleIndex=void 0,e.modelIsDirty=!1,e.editedRuleCopy=void 0},v=()=>{e.modelIsDirty=!Object(r.isEqual)(e.rulesModel,e.rulesModelCopy)},b=()=>a.getActiveRepository(),f=()=>{s.error(c.instant("acl_management.errors.duplicated_rules"))},_=t=>{e.modelIsDirty&&(t.returnValue=!0)},w=()=>{window.removeEventListener("beforeunload",_),p.forEach(e=>e())},y=(s,l)=>{e.modelIsDirty&&(s.preventDefault(),i.openSimpleModal({title:c.instant("common.confirm"),message:c.instant("acl_management.rulestable.messages.unsaved_changes_confirmation"),warning:!0}).result.then((function(){w();const e=t.absUrl().length-t.url().length,s=l.substring(e);t.path(s)}),(function(){})))},j=()=>{e.getAutocompletePromise=d.checkAutocompleteStatus()};u.getNamespaces(a.getActiveRepository()).then(o.mapNamespacesResponse).then(t=>{e.namespaces=t}).catch(e=>{const t=getError(e);s.error(t,c.instant("error.getting.namespaces.for.repo"))}),p.push(e.$on("autocompleteStatus",j)),p.push(e.$watch(b,h)),p.push(e.$on("$locationChangeStart",y)),p.push(e.$on("$destroy",w)),window.addEventListener("beforeunload",_)}angular.module("graphdb.framework.aclmanagement.controllers",["graphdb.framework.rest.plugins.service","graphdb.framework.rest.aclmanagement.service"]).controller("AclManagementCtrl",n),n.$inject=["$scope","$location","toastr","AclManagementRestService","$repositories","$translate","ModalService","RDF4JRepositoriesRestService","AutocompleteRestService"]}}]);